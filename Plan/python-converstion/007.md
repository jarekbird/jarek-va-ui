# TASK-TD-007: Implement NoteTakingPanel Component

**Section**: 5. Panel Component Implementation
**Subsection**: 5.1
**Task ID**: TASK-TD-007
**Order**: 007

## Description

This task implements the NoteTakingPanel component for the Task Dashboard. The component uses TanStack Query hooks to fetch and manage conversations, displays a list view and detail view, and handles creating new conversations and adding messages. It integrates with the TaskDashboard shell and triggers callbacks for cross-panel updates.

**Reference Implementation**: 
- `VirtualAssistant/jarek-va-ui/src/components/NoteTakingPanel.tsx`
- `VirtualAssistant/jarek-va-ui/src/components/NoteTakingPanel.css`

## Current State

- Conversations API hooks exist (TASK-TD-006)
- TaskDashboard shell exists (TASK-TD-005)
- No NoteTakingPanel component exists yet
- Backend contracts documented (TASK-TD-003)

**Important**: This component must use TanStack Query hooks (not direct API calls) and match the original NoteTakingPanel behavior.

## Checklist

### Preparation and Setup

- [ ] Navigate to `python-cursor/cursor-executor/cursor-executor-front` directory
- [ ] Review reference implementation: `VirtualAssistant/jarek-va-ui/src/components/NoteTakingPanel.tsx`
- [ ] Review reference CSS: `VirtualAssistant/jarek-va-ui/src/components/NoteTakingPanel.css`
- [ ] Review hooks from TASK-TD-006: `useConversationsQuery`, `useCreateConversationMutation`, `useAddMessageMutation`
- [ ] Review baseline documentation from TASK-TD-001
- [ ] Decide on component location: `src/components/` or `src/routes/task-dashboard/components/`

### Implementation Steps

- [ ] Step 1: Create NoteTakingPanel component structure
  - [ ] Create `NoteTakingPanel.tsx` in chosen location
  - [ ] Import React, TanStack Query hooks
  - [ ] Define props interface matching original:
    - [ ] `conversationId?: string`
    - [ ] `onConversationSelect?: (id: string | undefined) => void`
    - [ ] `onConversationUpdate?: () => void`
  - [ ] Create functional component with proper TypeScript types
- [ ] Step 2: Implement list view
  - [ ] Use `useConversationsQuery` to fetch conversations
  - [ ] Render conversation list with loading state
  - [ ] Render conversation list with error state (retry button)
  - [ ] Render conversation list with empty state
  - [ ] Render conversation list with success state
  - [ ] Handle conversation selection (call `onConversationSelect`)
  - [ ] Add "New Conversation" button/action
- [ ] Step 3: Implement detail view
  - [ ] Show detail view when `conversationId` is provided
  - [ ] Use `useConversationQuery` (or fetch from list) to get conversation details
  - [ ] Display messages in chronological order
  - [ ] Add message input form
  - [ ] Use `useAddMessageMutation` to post messages
  - [ ] Call `onConversationUpdate` after successful message post
  - [ ] Add "Back to List" button
- [ ] Step 4: Implement conversation creation
  - [ ] Use `useCreateConversationMutation` to create conversations
  - [ ] Handle creation success (select new conversation, call callbacks)
  - [ ] Handle creation errors
- [ ] Step 5: Create NoteTakingPanel CSS
  - [ ] Create `NoteTakingPanel.css` in same location
  - [ ] Port styles from reference CSS
  - [ ] Adapt to cursor-executor-front design system
  - [ ] Ensure responsive behavior
- [ ] Step 6: Integrate into TaskDashboard
  - [ ] Open `TaskDashboard.tsx`
  - [ ] Import `NoteTakingPanel`
  - [ ] Replace placeholder in notes region with `<NoteTakingPanel />`
  - [ ] Pass props: `conversationId={selectedNoteConversationId}`, `onConversationSelect`, `onConversationUpdate={handleNoteConversationUpdate}`

### Specific Requirements

- [ ] Requirement 1: Component structure
  - [ ] Component follows React functional component pattern
  - [ ] Component uses TypeScript with proper types
  - [ ] Component has proper prop types
  - [ ] Component exports correctly
- [ ] Requirement 2: TanStack Query integration
  - [ ] Uses `useConversationsQuery` for list
  - [ ] Uses `useConversationQuery` for details (if needed)
  - [ ] Uses `useCreateConversationMutation` for creation
  - [ ] Uses `useAddMessageMutation` for messages
  - [ ] Handles loading, error, and success states
- [ ] Requirement 3: UI states
  - [ ] Loading state (spinner/message)
  - [ ] Error state (message + retry)
  - [ ] Empty state (no conversations)
  - [ ] List view (conversation list)
  - [ ] Detail view (messages + input)
- [ ] Requirement 4: Callback integration
  - [ ] Calls `onConversationSelect` when conversation selected
  - [ ] Calls `onConversationUpdate` after message post or creation
  - [ ] Handles undefined callbacks gracefully

### Error Handling and Edge Cases

- [ ] Component handles network errors
- [ ] Component handles API errors (400, 404, 500)
- [ ] Component handles empty conversation list
- [ ] Component handles empty message list
- [ ] Component handles undefined conversationId
- [ ] Component handles undefined callbacks
- [ ] Component handles mutation errors gracefully

### Testing

- [ ] Step 1: Create test file
  - [ ] Create `NoteTakingPanel.test.tsx` in same location
  - [ ] Import React Testing Library utilities
  - [ ] Import component to test
  - [ ] Set up QueryClientProvider wrapper
- [ ] Step 2: Write rendering tests
  - [ ] Test: Component renders without crashing
  - [ ] Test: Component shows loading state
  - [ ] Test: Component shows error state
  - [ ] Test: Component shows empty state
  - [ ] Test: Component shows list view
  - [ ] Test: Component shows detail view when conversationId provided
- [ ] Step 3: Write interaction tests
  - [ ] Test: Selecting conversation calls `onConversationSelect`
  - [ ] Test: Creating conversation calls `onConversationUpdate`
  - [ ] Test: Adding message calls `onConversationUpdate`
  - [ ] Test: Back to list button works
  - [ ] Mock hooks to simulate different states
- [ ] Step 4: Write mutation tests
  - [ ] Test: Create conversation mutation works
  - [ ] Test: Add message mutation works
  - [ ] Test: Mutations handle errors
- [ ] Step 5: Run tests
  - [ ] Run: `npm test NoteTakingPanel`
  - [ ] Verify: All tests pass
  - [ ] Verify: Test coverage is adequate

### Documentation

- [ ] Add JSDoc comment to NoteTakingPanel component
  - [ ] Describe component purpose
  - [ ] Document props
  - [ ] Document callback behavior
- [ ] Add comments to complex logic
- [ ] Document any deviations from original implementation

### Verification

- [ ] Verify component renders in development
  - [ ] Run: `npm run dev`
  - [ ] Navigate to `/task-dashboard`
  - [ ] Verify: NoteTakingPanel appears in notes region
  - [ ] Verify: List view works
  - [ ] Verify: Detail view works
  - [ ] Verify: Creating conversations works
  - [ ] Verify: Adding messages works
- [ ] Verify callbacks work
  - [ ] Verify: Selecting conversation triggers callback
  - [ ] Verify: Updating conversation triggers callback
- [ ] Verify tests pass
- [ ] Verify no console errors or warnings

## Notes

- This task is part of the Task Dashboard React/TanStack Port project
- **Execution Timing**: Must be completed after TASK-TD-006 and TASK-TD-005
- **Dependencies**:
  - TASK-TD-006: Provides API hooks
  - TASK-TD-005: Provides TaskDashboard shell
- **Important Considerations**:
  - Must use TanStack Query hooks (not direct API calls)
  - Must match original behavior and callbacks
  - CSS should match original as closely as possible
- **Task Independence**: Can be completed independently after dependencies
- **Current State**: API hooks exist, component needs to be created

## Related Tasks

- Previous: TASK-TD-006
- Next: TASK-TD-008
- Dependencies:
  - TASK-TD-006: Provides API hooks
  - TASK-TD-005: Provides TaskDashboard shell
- Related:
  - TASK-TD-013: Will wire cross-panel interactions

## Definition of Done

### User Stories

**As a user**, **I need** to view and manage conversations/notes in the Task Dashboard **so that** I can take notes and track conversations.

**As a developer**, **I need** a NoteTakingPanel component that uses TanStack Query **so that** I can integrate it into the Task Dashboard.

### Automated Tests

- [ ] Component renders correctly
  - [ ] Test file: `src/components/NoteTakingPanel.test.tsx` (or matching location)
  - [ ] Test: Renders without crashing
  - [ ] Test: Shows loading, error, empty, and success states
  - [ ] Test: List view and detail view work
  - [ ] Run: `npm test NoteTakingPanel`
  - [ ] Verify: All rendering tests pass
- [ ] Callbacks work correctly
  - [ ] Test: `onConversationSelect` is called when conversation selected
  - [ ] Test: `onConversationUpdate` is called after mutations
  - [ ] Verify: All callback tests pass
- [ ] Mutations work correctly
  - [ ] Test: Create conversation mutation works
  - [ ] Test: Add message mutation works
  - [ ] Verify: All mutation tests pass
- [ ] All tests pass
  - [ ] Run: `npm test`
  - [ ] Verify: Exit code is 0, all tests pass
- [ ] Type checking passes
  - [ ] Run: `npm run type-check`
  - [ ] Verify: No type errors
- [ ] Linting passes
  - [ ] Run: `npm run lint`
  - [ ] Verify: No linting errors

### Code Quality

- [ ] NoteTakingPanel.tsx follows React best practices
- [ ] Component uses TanStack Query hooks correctly
- [ ] Component is properly typed (TypeScript)
- [ ] CSS matches original design
- [ ] Code follows project conventions

### Git Commit and Push

- [ ] All changes are committed to git:
  - [ ] `src/components/NoteTakingPanel.tsx` (new file)
  - [ ] `src/components/NoteTakingPanel.css` (new file)
  - [ ] `src/components/NoteTakingPanel.test.tsx` (new file)
  - [ ] `src/components/TaskDashboard.tsx` (modified - integrates NoteTakingPanel)
- [ ] Commit message follows project conventions: `"TASK-TD-007: Implement NoteTakingPanel component"`
- [ ] Changes are pushed to origin: `git push origin <branch-name>`
- [ ] Verify push was successful: `git log --oneline -1` shows the commit

### Final Verification

- [ ] NoteTakingPanel component exists and renders correctly
- [ ] Component works in Task Dashboard
- [ ] Callbacks trigger correctly
- [ ] All tests pass
- [ ] Type checking passes
- [ ] Linting passes
- [ ] Code is committed and pushed to origin
- [ ] Task is ready for handoff to TASK-TD-008

