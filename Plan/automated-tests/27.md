# TASK-27: Add integration tests for task list → detail flow

**Section**: 6. Integration Tests for Critical Flows (Phase 3)
**Subsection**: 6.3 Task List to Detail Integration
**Task ID**: TASK-27

## Description

This task creates comprehensive integration tests for the task list to detail view flow. These tests verify that users can navigate from the task list to a task detail view, and that the detail view correctly displays task information.

The tests will verify:
- Task list loads and displays tasks
- Clicking a task in the list navigates to detail view
- Detail view loads and displays task information
- Error/404 scenarios are handled correctly
- Navigation back to list works correctly
- Active task highlighting works correctly

This is an integration test that exercises routing and component coordination.

## Current State

- `TaskListView` component exists and displays task list
- `TaskDetailView` component exists and displays task details
- `TaskList` component handles task selection and navigation
- Routing connects list and detail views
- No integration tests currently exist for this flow
- Unit tests for individual components may exist (from TASK-12, TASK-13, TASK-14)

**Reference Implementation**: 
- `src/components/TaskListView.tsx`
- `src/components/TaskDetailView.tsx`
- `src/components/TaskList.tsx`
- Existing integration test patterns (if any)

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, TASK-12, TASK-13, TASK-14 are complete (all unit tests for components, APIs, and utilities).

## Checklist

### Preparation and Setup

- [ ] Review `TaskListView.tsx` component
- [ ] Review `TaskDetailView.tsx` component
- [ ] Review `TaskList.tsx` component
- [ ] Review routing configuration
- [ ] Review existing integration test patterns
- [ ] Understand the navigation flow

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/__tests__/tasks-flow-integration.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Import `App` or set up routing manually
  - [ ] Set up MSW handlers

- [ ] Step 2: Set up test structure
  - [ ] Create describe block for task list → detail flow
  - [ ] Set up MSW handlers for tasks API (list and detail)
  - [ ] Create mock task data
  - [ ] Set up MemoryRouter starting at `/tasks`

- [ ] Step 3: Write tests for list view
  - [ ] Test: Task list loads and displays tasks
  - [ ] Test: Tasks are rendered correctly
  - [ ] Test: Loading state is shown then hidden
  - [ ] Test: Error state is handled correctly

- [ ] Step 4: Write tests for navigation to detail
  - [ ] Test: Clicking a task in TaskList navigates to `/tasks/:id`
  - [ ] Test: URL changes to detail route
  - [ ] Test: Active task is highlighted in list (if list is still visible)
  - [ ] Test: Navigation works for different task IDs

- [ ] Step 5: Write tests for detail view
  - [ ] Test: Detail view loads task data from API
  - [ ] Test: Task details are displayed correctly
  - [ ] Test: Loading state is shown then hidden
  - [ ] Test: Task information is rendered correctly

- [ ] Step 6: Write tests for error scenarios
  - [ ] Test: 404 error shows "Task not found" message
  - [ ] Test: Other errors show appropriate error messages
  - [ ] Test: Error states don't break navigation
  - [ ] Test: Back navigation works even after errors

- [ ] Step 7: Write tests for back navigation
  - [ ] Test: Back link navigates to `/tasks`
  - [ ] Test: Browser back button works correctly
  - [ ] Test: List view is restored after back navigation

- [ ] Step 8: Write tests for full flow
  - [ ] Test: Complete flow: list → detail → back → list
  - [ ] Test: Multiple task selections work correctly
  - [ ] Test: State is preserved correctly during navigation

### Specific Requirements

- [ ] Requirement 1: List view tested
  - Task list loads correctly
  - Tasks are displayed correctly
  - Loading and error states work

- [ ] Requirement 2: Navigation tested
  - Clicking task navigates correctly
  - URL changes correctly
  - Active state updates correctly

- [ ] Requirement 3: Detail view tested
  - Task details load correctly
  - Task information is displayed correctly
  - Loading and error states work

- [ ] Requirement 4: Error handling tested
  - 404 errors are handled
  - Other errors are handled
  - Navigation works after errors

### Error Handling and Edge Cases

- [ ] Handle case: Task is deleted between list and detail load
  - 404 error is shown
  - Navigation still works

- [ ] Handle case: Network error during detail load
  - Error message is shown
  - User can retry or navigate back

- [ ] Handle case: Invalid task ID in URL
  - Error is shown
  - Navigation still works

### Testing

- [ ] Write all integration test cases
- [ ] Use MSW to mock API responses
- [ ] Use MemoryRouter for routing tests
- [ ] Use userEvent for click interactions
- [ ] Test full user flow
- [ ] Run tests: `npm test -- tasks-flow-integration.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios
- [ ] Document navigation flow

### Verification

- [ ] Verify all task list → detail integration is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 6: Integration Tests for Critical Flows (Phase 3)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-12, TASK-13, TASK-14 are complete (all unit tests for components, APIs, and utilities)
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required)
  - TASK-4: Configure coverage thresholds
  - TASK-12: Add tests for TaskList
  - TASK-13: Add tests for TaskListView
  - TASK-14: Add tests for TaskDetailView
- **Important Considerations**: 
  - This is an integration test - test routing and component coordination
  - Use MSW to mock API responses
  - Use MemoryRouter starting at `/tasks`
  - Test full user flow from list to detail and back
  - Test error scenarios
  - Use userEvent for realistic user interactions
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: Task list and detail components exist but have no integration tests

## Related Tasks

- Previous: TASK-26 (Add integration tests for task dashboard flow)
- Next: TASK-28 (Add integration tests for working directory tree)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required)
  - TASK-4: Configure coverage thresholds
  - TASK-12: Add tests for TaskList
  - TASK-13: Add tests for TaskListView
  - TASK-14: Add tests for TaskDetailView
- Related: TASK-12, TASK-13, TASK-14 (unit tests for components used in this integration)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive integration tests for the task list to detail view flow.

**Definition of Done**: 

1. **Test file created**:
   - `src/__tests__/tasks-flow-integration.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - List view tested
   - Navigation to detail tested
   - Detail view tested
   - Error scenarios tested
   - Back navigation tested
   - Full flow tested

3. **Tests pass**:
   - All task flow integration tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - Integration test coverage is adequate
   - Coverage meets project thresholds

5. **Code quality**:
   - Tests use semantic queries
   - Tests use MSW for API mocking
   - Tests use MemoryRouter for routing
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add integration tests for task list to detail flow`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the task list and detail views
   - **I want** comprehensive integration tests that verify navigation and data flow between list and detail
   - **So that** I can confidently refactor and extend the task views without breaking functionality

8. **Automated Tests**:
   - All task flow integration tests written and passing
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- tasks-flow-integration.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/__tests__/tasks-flow-integration.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (list, navigation, detail, errors, back navigation, full flow)
- ✅ MSW used for API mocking
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
