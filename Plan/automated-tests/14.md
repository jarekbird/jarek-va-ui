# TASK-14: Add tests for `TaskDetailView`

**Section**: 3. Unit Tests for Untested Components (Phase 2A)
**Subsection**: 3.3 Task & Dashboard Components
**Task ID**: TASK-14

## Description

This task creates comprehensive unit tests for the `TaskDetailView` component. This component displays a single task's details, handles loading/error states, and provides navigation back to the task list.

The tests will verify:
- Successful loading and rendering of task details
- Invalid task ID handling (NaN)
- Error handling with appropriate messages
- "Task not found" state when task doesn't exist
- Back link navigation functionality
- Integration with MSW for API mocking
- Proper state management during loading

This component is the detail view counterpart to TaskListView and requires thorough test coverage.

## Current State

- `TaskDetailView` component exists at `src/components/TaskDetailView.tsx`
- Component uses `getTaskById` from `src/api/tasks`
- Component uses React Router (`useParams`, `Link`)
- Component renders `Navigation`, `TaskDetails`, `LoadingSpinner`, `ErrorMessage`
- Component handles loading, error, and not-found states
- Component validates task ID parameter (must be numeric)
- No tests currently exist for this component
- MSW should be set up (from TASK-3) for API mocking

**Reference Implementation**: 
- `src/components/TaskDetailView.tsx` (full file)
- `src/api/tasks.ts` for API client structure
- `src/components/__tests__/ConversationDetailView.test.tsx` for similar patterns

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, TASK-13 are complete.

## Checklist

### Preparation and Setup

- [ ] Review `TaskDetailView.tsx` component code
- [ ] Review `src/api/tasks.ts` to understand `getTaskById` API
- [ ] Review MSW handlers from TASK-3 for task detail endpoint
- [ ] Review `ConversationDetailView.test.tsx` for similar test patterns
- [ ] Understand Task type structure

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/components/__tests__/TaskDetailView.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Set up MSW handlers for task detail API

- [ ] Step 2: Set up test structure
  - [ ] Create describe block for TaskDetailView
  - [ ] Set up MSW handler for `GET /api/tasks/:id`
  - [ ] Create mock task data
  - [ ] Set up MemoryRouter with route params

- [ ] Step 3: Write tests for successful load
  - [ ] Test: Component loads task when valid numeric `taskId` param provided
  - [ ] Test: `getTaskById` is called with correct ID
  - [ ] Test: `TaskDetails` component receives task prop
  - [ ] Test: Navigation component is rendered
  - [ ] Test: Back link is rendered and navigates to `/tasks`
  - [ ] Test: LoadingSpinner shown during load, then hidden

- [ ] Step 4: Write tests for invalid task ID
  - [ ] Test: Invalid `taskId` (NaN) sets "Invalid task ID" error
  - [ ] Test: Error message is displayed
  - [ ] Test: Loading state is set to false
  - [ ] Test: No API call is made for invalid ID
  - [ ] Test: TaskDetails not rendered when ID is invalid

- [ ] Step 5: Write tests for error handling
  - [ ] Test: Backend error displays error message
  - [ ] Test: ErrorMessage component receives error message
  - [ ] Test: TaskDetails not rendered when error occurs
  - [ ] Test: LoadingSpinner hidden when error occurs

- [ ] Step 6: Write tests for not found state
  - [ ] Test: "Task not found." message shown when task is null
  - [ ] Test: Message only shown when not loading and no error
  - [ ] Test: TaskDetails not rendered when task is null

- [ ] Step 7: Write tests for routing behavior
  - [ ] Test: Component reads `taskId` from URL params
  - [ ] Test: Back link navigates to `/tasks` when clicked
  - [ ] Test: Component reloads when `taskId` param changes
  - [ ] Test: Component handles missing `taskId` param

- [ ] Step 8: Write tests for state management
  - [ ] Test: Loading state is true initially, then false after load
  - [ ] Test: Error state is cleared on successful load
  - [ ] Test: Task state updates correctly
  - [ ] Test: State resets when `taskId` changes

### Specific Requirements

- [ ] Requirement 1: API integration tested
  - `getTaskById` API call is tested
  - MSW handler works correctly
  - Error responses are handled
  - 404 responses show "Task not found" message

- [ ] Requirement 2: Parameter validation tested
  - Invalid task ID (NaN) is handled
  - Error message is appropriate
  - No API call is made for invalid ID

- [ ] Requirement 3: Routing behavior tested
  - URL parameter extraction works
  - Back link navigation works
  - Component responds to route changes

- [ ] Requirement 4: State management tested
  - Loading states are managed correctly
  - Error states are managed correctly
  - Task state updates correctly

### Error Handling and Edge Cases

- [ ] Handle case: `taskId` param is missing
  - Component handles gracefully
  - No API call is made
  - Appropriate state is shown

- [ ] Handle case: API returns 404
  - "Task not found." message is shown
  - No error is thrown
  - Component state is correct

- [ ] Handle case: API call fails with network error
  - Error message is displayed
  - User can see what went wrong

- [ ] Handle case: `taskId` changes in URL
  - Component reloads task
  - Previous state is cleared
  - New task is loaded

- [ ] Handle case: Task ID is string that can't be parsed
  - "Invalid task ID" error is shown
  - No API call is made

### Testing

- [ ] Write all test cases for TaskDetailView
- [ ] Use MSW to mock API responses
- [ ] Use MemoryRouter with different route params
- [ ] Test with userEvent for link clicks
- [ ] Run tests: `npm test -- TaskDetailView.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios

### Verification

- [ ] Verify all TaskDetailView functionality is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 3: Unit Tests for Untested Components (Phase 2A)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-13 are complete
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required for API mocking)
  - TASK-4: Configure coverage thresholds
  - TASK-13: Add tests for TaskListView (related component)
- **Important Considerations**: 
  - Use MSW handlers from TASK-3 for API mocking
  - Use MemoryRouter with `initialEntries` containing route params
  - Test parameter validation (NaN handling)
  - Mock child components if needed to isolate tests
  - Test all state transitions (loading → loaded, loading → error, etc.)
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: TaskDetailView component exists but has no tests

## Related Tasks

- Previous: TASK-13 (Add tests for TaskListView)
- Next: TASK-15 (Add tests for TaskDetails)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required)
  - TASK-4: Configure coverage thresholds
  - TASK-13: Add tests for TaskListView
- Related: TASK-13 (TaskListView is the list view counterpart), TASK-15 (TaskDetails is used by this component)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive unit tests for the TaskDetailView component.

**Definition of Done**: 

1. **Test file created**:
   - `src/components/__tests__/TaskDetailView.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - Successful load scenario tested
   - Invalid task ID handling tested
   - Error handling tested
   - Not found state tested
   - Routing behavior tested
   - State management tested

3. **Tests pass**:
   - All TaskDetailView tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - TaskDetailView component has adequate test coverage
   - Coverage meets project thresholds (≥80% minimum)

5. **Code quality**:
   - Tests use semantic queries
   - Tests use MSW for API mocking
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add comprehensive tests for TaskDetailView component`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the TaskDetailView component
   - **I want** comprehensive unit tests that verify API integration, parameter validation, error handling, and state management
   - **So that** I can confidently refactor and extend the component without breaking functionality

8. **Automated Tests**:
   - All TaskDetailView tests written and passing
   - Test coverage for component meets requirements
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- TaskDetailView.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/components/__tests__/TaskDetailView.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (load, invalid ID, errors, not found, routing, state)
- ✅ MSW used for API mocking
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
