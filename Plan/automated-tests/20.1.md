# TASK-20.1: Add tests for `src/api/queues.ts` - `listQueues` function

**Section**: 4. Unit Tests for Untested API Clients (Phase 2B)
**Subsection**: 4.1 Queue API Client
**Task ID**: TASK-20.1
**Parent Task**: TASK-20
**Order**: 1 of 2

## Description

This task creates comprehensive unit tests for the `listQueues` function in the `src/api/queues.ts` API client module. This function retrieves a list of all Bull MQ queues.

The tests will verify:
- Successful JSON responses
- Non-JSON responses
- Error responses (4xx/5xx)
- Error message extraction
- Response parsing

## Current State

- `src/api/queues.ts` exists and exports `listQueues` function
- Function uses `fetch` API directly
- Function checks content-type before parsing JSON
- Function extracts error messages from responses
- No tests currently exist for this function
- MSW should be set up (from TASK-3) for API mocking

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4 are complete.

## Checklist

### Implementation Steps

- [ ] Step 1: Create test file structure
  - [ ] Create `src/api/__tests__/queues.test.ts` (if not exists)
  - [ ] Import `listQueues` from `../queues`
  - [ ] Set up MSW handlers for `/agents/queues`

- [ ] Step 2: Write tests for successful responses
  - [ ] Test: Successful JSON response returns queue array
  - [ ] Test: Response with correct content-type is parsed
  - [ ] Test: Queue data structure is correct
  - [ ] Test: Multiple queues are returned correctly

- [ ] Step 3: Write tests for non-JSON responses
  - [ ] Test: Non-JSON response (wrong content-type) throws error
  - [ ] Test: Error message includes content-type information
  - [ ] Test: Error message includes response text (truncated)

- [ ] Step 4: Write tests for error responses
  - [ ] Test: 4xx response returns error with server message
  - [ ] Test: 5xx response returns error with server message
  - [ ] Test: Error response with JSON error payload propagates message
  - [ ] Test: Error response without JSON uses status text

### Specific Requirements

- [ ] All response scenarios tested
- [ ] Error messages are clear and meaningful
- [ ] MSW used for API mocking

### Testing

- [ ] Write all test cases for `listQueues`
- [ ] Use MSW to mock API responses
- [ ] Run tests: `npm test -- queues.test.ts`
- [ ] Verify all tests pass

## Related Tasks

- Parent: TASK-20
- Next: TASK-20.2

## Definition of Done

### Task Type: TESTING TASK

**Definition of Done**: 

1. **Tests written**: All `listQueues` tests written
2. **Tests pass**: All tests pass
3. **Code committed and pushed**: Commit message: `test: add tests for listQueues function`
4. **User Story**: As a developer, I want tests for `listQueues` so that I can verify it works correctly
5. **Automated Tests**: All tests written and passing

**Tests are written, all tests pass, and test coverage meets project requirements**















