# TASK-17: Add tests for `TaskDashboard`

**Section**: 3. Unit Tests for Untested Components (Phase 2A)
**Subsection**: 3.3 Task & Dashboard Components
**Task ID**: TASK-17

## Description

This task creates comprehensive unit tests for the `TaskDashboard` component. This component orchestrates four panels: file viewer (WorkingDirectoryBrowser), note-taking panel (NoteTakingPanel), task management panel (TaskManagementPanel), and queue view (BullMQQueueView). It handles coordination between panels, particularly refreshing file browser and task panel when note conversations are updated.

The tests will verify:
- All four panels are rendered correctly
- Note conversation updates trigger refresh on both file browser and task panel
- Ref-based communication between parent and child components works
- Component layout and structure
- Integration with child components

This is a complex orchestration component that requires thorough test coverage of inter-component communication.

## Current State

- `TaskDashboard` component exists at `src/components/TaskDashboard.tsx`
- Component uses refs to communicate with `WorkingDirectoryBrowser` and `TaskManagementPanel`
- Component renders four panels: WorkingDirectoryBrowser, NoteTakingPanel, TaskManagementPanel, BullMQQueueView
- Component handles `onConversationUpdate` callback from NoteTakingPanel
- Component refreshes file browser and task panel when notes are updated
- No tests currently exist for this component

**Reference Implementation**: 
- `src/components/TaskDashboard.tsx` (full file)
- `src/components/WorkingDirectoryBrowser.tsx` for ref interface
- `src/components/TaskManagementPanel.tsx` for ref interface

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, TASK-16, TASK-18 are complete.

## Checklist

### Preparation and Setup

- [ ] Review `TaskDashboard.tsx` component code
- [ ] Review `WorkingDirectoryBrowser` and `TaskManagementPanel` ref interfaces
- [ ] Review `NoteTakingPanel` component to understand `onConversationUpdate` callback
- [ ] Understand ref-based component communication patterns
- [ ] Review existing orchestration component tests for patterns

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/components/__tests__/TaskDashboard.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Set up mocks for child components

- [ ] Step 2: Set up test structure
  - [ ] Create describe block for TaskDashboard
  - [ ] Mock `WorkingDirectoryBrowser` to expose mock `refresh` function
  - [ ] Mock `TaskManagementPanel` to expose mock `refresh` function
  - [ ] Mock `NoteTakingPanel` to trigger `onConversationUpdate` callback
  - [ ] Mock `BullMQQueueView` (simple presentational component)

- [ ] Step 3: Write tests for panel rendering
  - [ ] Test: All four panels are rendered
  - [ ] Test: WorkingDirectoryBrowser is rendered with ref
  - [ ] Test: NoteTakingPanel is rendered with correct props
  - [ ] Test: TaskManagementPanel is rendered with ref
  - [ ] Test: BullMQQueueView is rendered
  - [ ] Test: Component has correct data-testid

- [ ] Step 4: Write tests for note conversation update flow
  - [ ] Test: When NoteTakingPanel fires `onConversationUpdate`, `WorkingDirectoryBrowser.refresh` is called
  - [ ] Test: When NoteTakingPanel fires `onConversationUpdate`, `TaskManagementPanel.refresh` is called
  - [ ] Test: Both refreshes are called when conversation is updated
  - [ ] Test: Ref methods are called correctly
  - [ ] Test: Multiple updates trigger multiple refreshes

- [ ] Step 5: Write tests for ref handling
  - [ ] Test: Refs are created and attached correctly
  - [ ] Test: Refs are available when needed
  - [ ] Test: Component handles missing refs gracefully (if applicable)

- [ ] Step 6: Write tests for component structure
  - [ ] Test: Component has correct CSS classes
  - [ ] Test: Layout structure is correct
  - [ ] Test: Panels are in correct order

### Specific Requirements

- [ ] Requirement 1: Panel rendering tested
  - All four panels are rendered
  - Panels receive correct props
  - Refs are attached correctly

- [ ] Requirement 2: Inter-component communication tested
  - Note conversation updates trigger refreshes
  - Both file browser and task panel are refreshed
  - Ref methods are called correctly

- [ ] Requirement 3: Component structure tested
  - Layout is correct
  - CSS classes are applied
  - Component structure is as expected

- [ ] Requirement 4: Ref handling tested
  - Refs are created and used correctly
  - Ref methods are accessible
  - Component handles ref lifecycle correctly

### Error Handling and Edge Cases

- [ ] Handle case: Ref is not available
  - Component handles gracefully
  - No errors thrown
  - Refresh is skipped if ref unavailable

- [ ] Handle case: Multiple rapid conversation updates
  - Component handles gracefully
  - Refreshes are called appropriately
  - No duplicate or missing refreshes

- [ ] Handle case: Child components fail to render
  - Component handles gracefully
  - Other panels still render
  - No errors thrown

### Testing

- [ ] Write all test cases for TaskDashboard
- [ ] Mock child components to isolate tests
- [ ] Use refs to test inter-component communication
- [ ] Use spies to verify method calls
- [ ] Run tests: `npm test -- TaskDashboard.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for ref testing patterns
- [ ] Add comments for inter-component communication tests

### Verification

- [ ] Verify all TaskDashboard functionality is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 3: Unit Tests for Untested Components (Phase 2A)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-16, TASK-18 are complete
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (not strictly needed but good to have)
  - TASK-4: Configure coverage thresholds
  - TASK-16: Add tests for TaskManagementPanel (uses this component)
  - TASK-18: Add tests for WorkingDirectoryBrowser (uses this component)
- **Important Considerations**: 
  - Mock child components to isolate tests
  - Use refs to test inter-component communication
  - Use spies to verify `refresh()` method calls
  - Test the orchestration logic carefully
  - Focus on inter-component communication, not individual panel functionality
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: TaskDashboard component exists but has no tests

## Related Tasks

- Previous: TASK-16 (Add tests for TaskManagementPanel)
- Next: TASK-18 (Add tests for WorkingDirectoryBrowser)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (recommended)
  - TASK-4: Configure coverage thresholds
  - TASK-16: Add tests for TaskManagementPanel
  - TASK-18: Add tests for WorkingDirectoryBrowser
- Related: TASK-16, TASK-18 (components used by TaskDashboard)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive unit tests for the TaskDashboard orchestration component.

**Definition of Done**: 

1. **Test file created**:
   - `src/components/__tests__/TaskDashboard.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - Panel rendering tested
   - Note conversation update flow tested
   - Ref handling tested
   - Component structure tested

3. **Tests pass**:
   - All TaskDashboard tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - TaskDashboard component has adequate test coverage
   - Coverage meets project thresholds (≥80% minimum)

5. **Code quality**:
   - Tests use semantic queries
   - Tests mock child components appropriately
   - Tests verify ref-based communication
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add comprehensive tests for TaskDashboard orchestration component`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the TaskDashboard component
   - **I want** comprehensive unit tests that verify panel orchestration and inter-component communication
   - **So that** I can confidently refactor and extend the component without breaking functionality

8. **Automated Tests**:
   - All TaskDashboard tests written and passing
   - Test coverage for component meets requirements
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- TaskDashboard.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/components/__tests__/TaskDashboard.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (panel rendering, inter-component communication, ref handling)
- ✅ Child components mocked appropriately
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
