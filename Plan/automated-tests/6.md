# TASK-6: Add tests for `ConversationListView`

**Section**: 3. Unit Tests for Untested Components (Phase 2A)
**Subsection**: 3.1 Navigation & Routing Components
**Task ID**: TASK-6

## Description

This task creates comprehensive unit tests for the `ConversationListView` component. This component is responsible for displaying the list of note-taking conversations, handling loading/error states, creating new conversations, and managing navigation between list and detail views.

The tests will verify:
- Successful loading and rendering of conversations list
- Error handling with user-friendly messages and retry functionality
- New conversation creation in both standalone and dashboard modes
- Active conversation highlighting based on URL
- Loading and empty states
- Integration with MSW for API mocking

This component is critical for the note-taking feature and requires thorough test coverage.

## Current State

- `ConversationListView` component exists at `src/components/ConversationListView.tsx`
- Component uses `listConversations` and `createConversation` from `src/api/conversations`
- Component uses React Router (`useLocation`, `useNavigate`)
- Component has props for dashboard mode (`onNewConversation`, `onConversationSelect`)
- Component renders `Navigation`, `ConversationList`, `LoadingSpinner`, `ErrorMessage`
- No tests currently exist for this component
- MSW should be set up (from TASK-3) for API mocking

**Reference Implementation**: 
- `src/components/ConversationListView.tsx` (full file)
- `src/api/conversations.ts` for API client structure
- Existing component tests for patterns

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, and TASK-5 are complete.

## Checklist

### Preparation and Setup

- [ ] Review `ConversationListView.tsx` component code
- [ ] Review `src/api/conversations.ts` to understand API structure
- [ ] Review MSW handlers from TASK-3 for conversations endpoints
- [ ] Review existing component test patterns
- [ ] Understand Conversation type structure

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/components/__tests__/ConversationListView.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Set up MSW handlers for conversations API

- [ ] Step 2: Set up test structure
  - [ ] Create describe block for ConversationListView
  - [ ] Set up MSW handlers for `/api/conversations` (GET, POST)
  - [ ] Create mock conversation data
  - [ ] Set up MemoryRouter for routing tests

- [ ] Step 3: Write tests for successful load
  - [ ] Test: Component loads and displays list of conversations
  - [ ] Test: Active conversation is highlighted based on URL
  - [ ] Test: ConversationList component receives correct props
  - [ ] Test: Navigation component is rendered when `showNavigation` is true
  - [ ] Test: Container div is rendered when `showContainer` is true

- [ ] Step 4: Write tests for error handling
  - [ ] Test: Network error displays friendly message and retry button
  - [ ] Test: 404 error displays appropriate message
  - [ ] Test: 500 error displays appropriate message
  - [ ] Test: Retry button calls `loadConversations` again
  - [ ] Test: Error message is cleared on successful retry

- [ ] Step 5: Write tests for new conversation creation (standalone mode)
  - [ ] Test: Clicking "+ New Note" calls `createConversation` API
  - [ ] Test: After creation, navigates to `/conversation/:id`
  - [ ] Test: After creation, reloads conversations list
  - [ ] Test: Button shows "Creating..." state during creation
  - [ ] Test: Button is disabled during creation
  - [ ] Test: Error during creation shows error message

- [ ] Step 6: Write tests for new conversation creation (dashboard mode)
  - [ ] Test: When `onNewConversation` prop provided, calls callback instead of navigating
  - [ ] Test: Callback receives new conversation ID
  - [ ] Test: List is reloaded after creation
  - [ ] Test: Navigation does not occur in dashboard mode

- [ ] Step 7: Write tests for loading and empty states
  - [ ] Test: LoadingSpinner shown during initial load
  - [ ] Test: Empty state message shown when no conversations
  - [ ] Test: Loading state clears after data loads
  - [ ] Test: Empty state only shown when not loading and no error

- [ ] Step 8: Write tests for props behavior
  - [ ] Test: `showNavigation={false}` hides Navigation component
  - [ ] Test: `showContainer={false}` uses different container class
  - [ ] Test: `onConversationSelect` prop is passed to ConversationList

### Specific Requirements

- [ ] Requirement 1: API integration tested
  - `listConversations` API call is tested
  - `createConversation` API call is tested
  - MSW handlers work correctly
  - Error responses are handled

- [ ] Requirement 2: Routing behavior tested
  - Navigation to detail view works
  - URL-based active conversation highlighting works
  - Dashboard mode vs standalone mode routing differs correctly

- [ ] Requirement 3: User interactions tested
  - Button clicks trigger correct actions
  - Loading states are shown/hidden correctly
  - Error states are displayed correctly
  - Retry functionality works

- [ ] Requirement 4: Component integration tested
  - Child components (Navigation, ConversationList, etc.) are rendered
  - Props are passed correctly to child components
  - Component state management works

### Error Handling and Edge Cases

- [ ] Handle case: API returns empty array
  - Empty state is displayed correctly
  - No errors are thrown

- [ ] Handle case: API call fails with network error
  - Friendly error message is shown
  - Retry button is functional

- [ ] Handle case: Conversation creation fails
  - Error message is displayed
  - User can retry creation
  - State is reset correctly

- [ ] Handle case: Multiple rapid clicks on "New Note"
  - Only one conversation is created
  - Button is disabled during creation
  - No duplicate API calls

### Testing

- [ ] Write all test cases for ConversationListView
- [ ] Use MSW to mock API responses
- [ ] Use userEvent for user interactions
- [ ] Test with MemoryRouter for routing
- [ ] Run tests: `npm test -- ConversationListView.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios

### Verification

- [ ] Verify all ConversationListView functionality is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 3: Unit Tests for Untested Components (Phase 2A)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-5 are complete
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required for API mocking)
  - TASK-4: Configure coverage thresholds
  - TASK-5: Add tests for Navigation (related component)
- **Important Considerations**: 
  - Use MSW handlers from TASK-3 for API mocking
  - Test both standalone and dashboard modes
  - Use MemoryRouter with different initialEntries for routing tests
  - Mock child components if needed to isolate tests
  - Use userEvent for realistic user interactions
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: ConversationListView component exists but has no tests

## Related Tasks

- Previous: TASK-5 (Add tests for Navigation)
- Next: TASK-7 (Add tests for ConversationDetailView)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (required)
  - TASK-4: Configure coverage thresholds
  - TASK-5: Add tests for Navigation
- Related: TASK-7 (ConversationDetailView is the detail view counterpart)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive unit tests for the ConversationListView component.

**Definition of Done**: 

1. **Test file created**:
   - `src/components/__tests__/ConversationListView.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - Successful load scenario tested
   - Error handling tested (network, 404, 500)
   - New conversation creation tested (both modes)
   - Loading and empty states tested
   - Routing behavior tested
   - Props behavior tested

3. **Tests pass**:
   - All ConversationListView tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - ConversationListView component has adequate test coverage
   - Coverage meets project thresholds (≥80% minimum)

5. **Code quality**:
   - Tests use semantic queries
   - Tests use MSW for API mocking
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add comprehensive tests for ConversationListView component`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the ConversationListView component
   - **I want** comprehensive unit tests that verify API integration, error handling, and user interactions
   - **So that** I can confidently refactor and extend the component without breaking functionality

8. **Automated Tests**:
   - All ConversationListView tests written and passing
   - Test coverage for component meets requirements
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- ConversationListView.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/components/__tests__/ConversationListView.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (load, errors, creation, states, routing)
- ✅ MSW used for API mocking
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
