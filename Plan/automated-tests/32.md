# TASK-32: Set up Playwright or Cypress for E2E

**Section**: 7. E2E, Accessibility, and Regression Tests (Phase 4)
**Subsection**: 7.1 E2E Framework Setup
**Task ID**: TASK-32

## Description

This task sets up an end-to-end (E2E) testing framework (Playwright or Cypress) for the jarek-va-ui application. E2E tests run against a real browser and verify that the application works correctly from a user's perspective.

The setup will include:
- Choosing and installing E2E framework (recommended: Playwright)
- Creating E2E configuration
- Setting up test environment to build and start the app
- Configuring test runner to run against the app
- Adding npm scripts for E2E tests
- Creating initial test structure

This establishes the foundation for writing E2E tests in subsequent tasks.

## Current State

- No E2E testing framework is currently installed or configured
- Application can be built and run locally
- Application may have a build script
- Application may have a dev server script
- No E2E test infrastructure exists

**Reference Implementation**: 
- Playwright documentation: https://playwright.dev/
- Cypress documentation: https://docs.cypress.io/
- Existing E2E setup patterns (if any)

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4 are complete (all unit tests for components, APIs, and utilities, and integration tests).

## Checklist

### Preparation and Setup

- [ ] Review E2E framework options (Playwright vs Cypress)
- [ ] Review application build and dev server setup
- [ ] Review package.json scripts
- [ ] Understand application port configuration
- [ ] Review existing E2E setup patterns (if any)

### Implementation Steps

- [ ] Step 1: Choose E2E framework
  - [ ] Evaluate Playwright vs Cypress
  - [ ] Choose framework (recommended: Playwright for better performance and modern features)
  - [ ] Document choice and rationale

- [ ] Step 2: Install E2E framework
  - [ ] Install Playwright: `npm install --save-dev @playwright/test`
  - [ ] Or install Cypress: `npm install --save-dev cypress`
  - [ ] Install browsers (for Playwright): `npx playwright install`
  - [ ] Verify installation completes successfully

- [ ] Step 3: Create E2E configuration
  - [ ] Create `playwright.config.ts` (if using Playwright)
  - [ ] Or create `cypress.config.ts` (if using Cypress)
  - [ ] Configure test directory
  - [ ] Configure test environment
  - [ ] Configure base URL
  - [ ] Configure timeouts
  - [ ] Configure browser options

- [ ] Step 4: Set up test environment
  - [ ] Configure framework to build app before tests
  - [ ] Configure framework to start app on known port
  - [ ] Configure framework to run tests against that port
  - [ ] Configure framework to stop app after tests
  - [ ] Test that build and start process works

- [ ] Step 5: Add npm scripts
  - [ ] Add `npm run e2e` script to run E2E tests
  - [ ] Add `npm run e2e:ui` script for interactive mode (if applicable)
  - [ ] Add `npm run e2e:headed` script for headed mode (if applicable)
  - [ ] Verify scripts work correctly

- [ ] Step 6: Create initial test structure
  - [ ] Create `e2e/` directory (or `tests/e2e/`)
  - [ ] Create initial test file to verify setup
  - [ ] Write simple test that visits app and verifies it loads
  - [ ] Run test to verify setup works

- [ ] Step 7: Configure CI integration (if applicable)
  - [ ] Update CI configuration to run E2E tests
  - [ ] Configure CI to install browsers
  - [ ] Configure CI to build and start app
  - [ ] Test CI integration

### Specific Requirements

- [ ] Requirement 1: Framework installed
  - E2E framework is installed
  - Browsers are installed (for Playwright)
  - Installation completes successfully

- [ ] Requirement 2: Configuration created
  - Configuration file exists
  - Configuration is correct
  - Test environment is configured

- [ ] Requirement 3: Test environment works
  - App builds successfully
  - App starts on known port
  - Tests can run against app
  - App stops after tests

- [ ] Requirement 4: Scripts work
  - npm scripts are added
  - Scripts run successfully
  - Tests can be executed

### Error Handling and Edge Cases

- [ ] Handle case: Build fails
  - Error is shown clearly
  - Test run is aborted

- [ ] Handle case: App fails to start
  - Error is shown clearly
  - Test run is aborted

- [ ] Handle case: Port is already in use
  - Error is shown clearly
  - Alternative port is used or error is clear

### Testing

- [ ] Verify E2E framework installation
- [ ] Verify configuration is correct
- [ ] Verify test environment setup works
- [ ] Run initial test to verify setup
- [ ] Verify npm scripts work
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`

### Documentation

- [ ] Document E2E framework choice and rationale
- [ ] Document configuration options
- [ ] Document how to run E2E tests
- [ ] Document test environment setup
- [ ] Update README with E2E testing information (if applicable)

### Verification

- [ ] Verify E2E framework is installed
- [ ] Verify configuration is correct
- [ ] Verify test environment works
- [ ] Verify initial test passes
- [ ] Verify npm scripts work

## Notes

- This task is part of Section 7: E2E, Accessibility, and Regression Tests (Phase 4)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4 are complete (all unit tests for components, APIs, and utilities, and integration tests)
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (not needed for E2E)
  - TASK-4: Configure coverage thresholds
- **Important Considerations**: 
  - Playwright is recommended for better performance and modern features
  - Configure test environment to build and start app automatically
  - Use a known port for the app (e.g., 3000 or 5173)
  - Configure framework to wait for app to be ready before running tests
  - Set up proper cleanup (stop app after tests)
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: No E2E framework is installed or configured

## Related Tasks

- Previous: TASK-31 (Add integration tests for voice dashboard)
- Next: TASK-33 (Implement core E2E journeys)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (not required)
  - TASK-4: Configure coverage thresholds
- Related: TASK-33 (E2E tests will use this setup)

## Definition of Done

### Task Type: SYSTEM/ENVIRONMENT OPERATION TASK + CONFIGURATION TASK

**Description**: This task involves installing E2E framework, creating configuration, and setting up test environment.

**Definition of Done**: 

1. **E2E framework installed**:
   - Framework package is installed (Playwright or Cypress)
   - Browsers are installed (for Playwright)
   - Installation completes successfully

2. **Configuration created**:
   - Configuration file exists (playwright.config.ts or cypress.config.ts)
   - Configuration is correct
   - Test environment is configured

3. **Test environment works**:
   - App builds successfully before tests
   - App starts on known port
   - Tests can run against app
   - App stops after tests

4. **Scripts added**:
   - `npm run e2e` script exists and works
   - Additional scripts added as needed
   - Scripts run successfully

5. **Initial test passes**:
   - Initial test file created
   - Test verifies app loads
   - Test passes successfully

6. **Code committed and pushed**:
   - Configuration file committed
   - package.json changes committed
   - Initial test file committed
   - Commit message: `feat: set up Playwright (or Cypress) for E2E testing`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the application
   - **I want** an E2E testing framework set up and configured
   - **So that** I can write end-to-end tests that verify the application works correctly from a user's perspective

8. **Automated Tests**:
   - Initial E2E test written and passing
   - Test verification: Run `npm run e2e` and confirm initial test passes
   - Framework is ready for writing additional E2E tests

**Acceptance Criteria**:
- ✅ E2E framework installed (Playwright or Cypress)
- ✅ Configuration file created and configured correctly
- ✅ Test environment builds and starts app automatically
- ✅ `npm run e2e` script exists and works
- ✅ Initial test passes
- ✅ All changes committed and pushed to origin

**The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete.**
