# TASK-2: Review existing test utilities

**Section**: 1. Baseline & Environment Setup
**Subsection**: 1.2
**Task ID**: TASK-2

## Description

This task involves reviewing and verifying the existing test utility setup in the jarek-va-ui project. The test utilities (`src/test/setup.ts` and `src/test/test-utils.tsx`) provide the foundation for all testing in the project. We need to ensure they are properly configured with:

1. Jest-DOM matchers for better assertions
2. jsdom environment for React component testing
3. Custom render function with React Router integration
4. Proper cleanup between tests

This verification ensures that the test infrastructure is ready to support the comprehensive test suite we'll be building.

## Current State

- `src/test/setup.ts` exists and imports `@testing-library/jest-dom`
- `src/test/test-utils.tsx` exists and provides a custom `render` function
- The custom render wraps components in `MemoryRouter` from `react-router-dom`
- Global cleanup is configured in `setup.ts` using Vitest's `afterEach`
- The project uses Vitest as the test runner (not Jest)

**Reference Implementation**: 
- `src/test/setup.ts` (lines 1-14)
- `src/test/test-utils.tsx` (lines 1-24)

**Important**: This task should be executed after TASK-1 (Confirm local setup) is complete.

## Checklist

### Preparation and Setup

- [ ] Review `src/test/setup.ts` file
- [ ] Review `src/test/test-utils.tsx` file
- [ ] Review existing test files to see how utilities are used
- [ ] Understand the current test setup structure
- [ ] Check `vitest.config.ts` to understand test environment configuration

### Implementation Steps

- [ ] Step 1: Review `src/test/setup.ts`
  - [ ] Open `src/test/setup.ts`
  - [ ] Verify `@testing-library/jest-dom` is imported
  - [ ] Verify `cleanup` from `@testing-library/react` is imported
  - [ ] Verify `afterEach` from `vitest` is used for cleanup
  - [ ] Verify `vi.restoreAllMocks()` is called in cleanup
  - [ ] Verify fake timers are restored if used
  - [ ] Document any missing configurations

- [ ] Step 2: Review `src/test/test-utils.tsx`
  - [ ] Open `src/test/test-utils.tsx`
  - [ ] Verify custom `render` function exists
  - [ ] Verify `MemoryRouter` is used to wrap components
  - [ ] Verify `AllTheProviders` component includes router
  - [ ] Verify all exports from `@testing-library/react` are re-exported
  - [ ] Verify custom `render` is exported
  - [ ] Check if additional providers are needed (Theme, Context, etc.)

- [ ] Step 3: Verify jsdom environment
  - [ ] Check `vitest.config.ts` for environment configuration
  - [ ] Verify `jsdom` is set as the test environment
  - [ ] Verify environment is properly configured for React testing

- [ ] Step 4: Test the utilities (if needed)
  - [ ] If any issues are found, fix them
  - [ ] Run `npm test` to verify utilities work correctly
  - [ ] Ensure existing tests still pass with current setup

### Specific Requirements

- [ ] Requirement 1: Jest-DOM matchers configured
  - `@testing-library/jest-dom` is imported in `setup.ts`
  - Matchers like `toBeInTheDocument()`, `toHaveClass()`, etc. are available
  - No errors when using jest-dom matchers in tests

- [ ] Requirement 2: jsdom environment active
  - Vitest is configured to use jsdom
  - DOM APIs are available in tests
  - React components can render in test environment

- [ ] Requirement 3: Custom render with Router
  - `test-utils.tsx` exports a `render` function
  - Components are wrapped in `MemoryRouter`
  - Router functionality works in tests
  - Tests can use `useNavigate`, `useLocation`, etc.

- [ ] Requirement 4: Proper cleanup
  - `afterEach` hook cleans up after each test
  - `cleanup()` is called from React Testing Library
  - Mocks are restored between tests
  - Fake timers are restored if used

### Error Handling and Edge Cases

- [ ] Handle case: `@testing-library/jest-dom` not imported
  - Add import if missing
  - Verify matchers work after import

- [ ] Handle case: jsdom not configured
  - Update `vitest.config.ts` to set environment to 'jsdom'
  - Verify DOM APIs are available

- [ ] Handle case: Custom render missing Router
  - Add `MemoryRouter` wrapper if missing
  - Ensure router is properly configured

- [ ] Handle case: Cleanup not working
  - Verify `afterEach` is properly configured
  - Ensure cleanup functions are called

### Testing

- [ ] Verify setup.ts configuration
  - Check that jest-dom is imported
  - Verify cleanup is configured
  - Run a simple test to verify setup works

- [ ] Verify test-utils.tsx functionality
  - Check that render function exists
  - Verify Router is included
  - Test that components can use router hooks

- [ ] Run existing tests: `npm test`
  - Verify all tests pass
  - Check for any setup-related errors
  - Ensure utilities are working correctly

- [ ] Run type checking: `npm run type-check`
  - Verify no type errors in test utilities
  - Fix any type issues

- [ ] Run linting: `npm run lint`
  - Fix any linting issues in test utility files

### Documentation

- [ ] Document current setup configuration
- [ ] Note any missing features that should be added
- [ ] Document any fixes made to the utilities
- [ ] Update comments in setup files if needed

### Verification

- [ ] Verify jest-dom matchers are available
- [ ] Verify jsdom environment is active
- [ ] Verify custom render works with Router
- [ ] Verify cleanup works between tests
- [ ] Verify all existing tests still pass

## Notes

- This task is part of Section 1: Baseline & Environment Setup
- **Execution Timing**: Execute after TASK-1 is complete
- **Dependencies**: 
  - TASK-1: Confirm local setup (must be complete)
- **Important Considerations**: 
  - The project uses Vitest, not Jest, so configuration may differ from Jest examples
  - jsdom must be configured in `vitest.config.ts`, not `setup.ts`
  - Custom render should wrap components in providers needed for testing
- **Task Independence**: Can be completed independently after TASK-1
- **Current State**: Test utilities exist but need verification

## Related Tasks

- Previous: TASK-1 (Confirm local setup)
- Next: TASK-3 (Introduce MSW for network mocking)
- Dependencies:
  - TASK-1: Confirm local setup
- Related: None

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**Description**: This task involves reviewing and potentially modifying test utility files (`src/test/setup.ts` and `src/test/test-utils.tsx`).

**Definition of Done**: 

1. **Review complete**:
   - `src/test/setup.ts` reviewed and verified
   - `src/test/test-utils.tsx` reviewed and verified
   - All required configurations are present

2. **Fixes applied (if needed)**:
   - Any missing imports added
   - Any missing configurations added
   - Any issues fixed

3. **Tests pass**:
   - All existing tests pass: `npm test` completes successfully
   - No test failures related to setup

4. **Code committed and pushed**:
   - All changes to test utility files committed
   - Commit message: `chore: review and verify test utilities setup`
   - Code pushed to origin: `git push origin <branch-name>`

5. **User Story** (as a developer):
   - **As a** developer writing tests
   - **I want** the test utilities to be properly configured with jest-dom, jsdom, and Router support
   - **So that** I can write effective component tests with proper assertions and routing

6. **Automated Tests**:
   - Existing tests must pass: `npm test` must complete successfully
   - No new tests are written in this task (verification only)
   - Test verification: Run `npm test` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/test/setup.ts` has `@testing-library/jest-dom` imported
- ✅ `src/test/test-utils.tsx` has custom `render` with `MemoryRouter`
- ✅ jsdom environment is configured in `vitest.config.ts`
- ✅ All existing tests pass
- ✅ Any fixes made are committed and pushed to origin

**A Pull Request was created OR code was pushed to origin with the task complete**
