# TASK-12: Add tests for `TaskList`

**Section**: 3. Unit Tests for Untested Components (Phase 2A)
**Subsection**: 3.3 Task & Dashboard Components
**Task ID**: TASK-12

## Description

This task creates comprehensive unit tests for the `TaskList` component. This component displays tasks grouped by status, with sorting, active state highlighting, and navigation to task details.

The tests will verify:
- Tasks are grouped by `status_label` in the correct order
- Tasks are sorted within each group by `order` then `id`
- Active task highlighting works from both props and URL
- Task selection triggers callbacks
- Status badges render with correct colors and labels
- Component renders correctly with different task lists

This component is similar to ConversationList but for tasks and requires thorough test coverage.

## Current State

- `TaskList` component exists at `src/components/TaskList.tsx`
- Component uses React Router (`Link`, `useLocation`)
- Component accepts `tasks`, `activeTaskId`, `onSelectTask` props
- Component groups tasks by `status_label` (ready, backlogged, complete, archived)
- Component sorts tasks within groups by `order` then `id`
- Component determines active state from prop or URL
- Component displays status badges with colors
- No tests currently exist for this component

**Reference Implementation**: 
- `src/components/TaskList.tsx` (full file)
- `src/components/__tests__/ConversationList.test.tsx` for similar patterns
- `src/types/index.ts` for Task type definition

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4 are complete.

## Checklist

### Preparation and Setup

- [ ] Review `TaskList.tsx` component code
- [ ] Review Task type definition
- [ ] Review `ConversationList.test.tsx` for similar test patterns
- [ ] Understand status grouping and sorting logic
- [ ] Understand status color mapping

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/components/__tests__/TaskList.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Import Task type

- [ ] Step 2: Set up test structure
  - [ ] Create describe block for TaskList
  - [ ] Create mock task data with different statuses
  - [ ] Set up MemoryRouter for routing tests
  - [ ] Create mock callback functions

- [ ] Step 3: Write tests for status grouping
  - [ ] Test: Tasks are grouped by `status_label`
  - [ ] Test: Groups appear in correct order: ready, backlogged, complete, archived
  - [ ] Test: Tasks with unknown status are handled gracefully
  - [ ] Test: Empty groups are not displayed

- [ ] Step 4: Write tests for sorting within groups
  - [ ] Test: Tasks within each group are sorted by `order` first
  - [ ] Test: Tasks with same `order` are sorted by `id`
  - [ ] Test: Sorting is stable (doesn't change order of equal items)
  - [ ] Test: Original array is not mutated

- [ ] Step 5: Write tests for active state (from prop)
  - [ ] Test: Active class applied when `activeTaskId` prop matches
  - [ ] Test: Active class not applied when prop doesn't match
  - [ ] Test: Multiple tasks, only one is active

- [ ] Step 6: Write tests for active state (from URL)
  - [ ] Test: Active class applied when URL matches task ID
  - [ ] Test: URL parsing extracts task ID correctly from `/tasks/:id`
  - [ ] Test: Prop takes precedence over URL when both provided
  - [ ] Test: Invalid URL task ID is handled gracefully

- [ ] Step 7: Write tests for task selection
  - [ ] Test: Clicking a task calls `onSelectTask` with task ID
  - [ ] Test: Link navigates to `/task/:id` (or `/tasks/:id` depending on routing)
  - [ ] Test: Selection works for tasks in all status groups

- [ ] Step 8: Write tests for status badges
  - [ ] Test: Status badges render with correct labels
  - [ ] Test: Status colors are correct for each status type
  - [ ] Test: Badge styles are applied correctly
  - [ ] Test: Unknown status uses default color

- [ ] Step 9: Write tests for rendering
  - [ ] Test: All tasks are rendered in correct groups
  - [ ] Test: Task details (title, status, etc.) are displayed
  - [ ] Test: Empty task list renders empty structure
  - [ ] Test: Component handles tasks with missing fields gracefully

### Specific Requirements

- [ ] Requirement 1: Grouping tested
  - Tasks grouped correctly by status_label
  - Groups appear in correct order
  - Unknown statuses handled

- [ ] Requirement 2: Sorting tested
  - Tasks sorted correctly within groups
  - Sort order is: order first, then id
  - Original array not mutated

- [ ] Requirement 3: Active state tested
  - Active state works from prop
  - Active state works from URL
  - Prop takes precedence over URL
  - Only one task is active at a time

- [ ] Requirement 4: Status display tested
  - Status badges render correctly
  - Status colors are correct
  - Badge styles are applied

### Error Handling and Edge Cases

- [ ] Handle case: Empty tasks array
  - Component renders empty structure
  - No errors thrown

- [ ] Handle case: Tasks with same order and id
  - Sorting is stable
  - Component renders correctly

- [ ] Handle case: Missing `onSelectTask` prop
  - Component still renders
  - Click handler doesn't crash

- [ ] Handle case: URL doesn't match any task
  - No task is marked active
  - Component renders normally

- [ ] Handle case: Invalid task ID in URL
  - Component handles gracefully
  - No errors thrown

### Testing

- [ ] Write all test cases for TaskList
- [ ] Use MemoryRouter with different routes
- [ ] Use userEvent for click interactions
- [ ] Run tests: `npm test -- TaskList.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios

### Verification

- [ ] Verify all TaskList functionality is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 3: Unit Tests for Untested Components (Phase 2A)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4 are complete
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (not strictly needed but good to have)
  - TASK-4: Configure coverage thresholds
- **Important Considerations**: 
  - Use MemoryRouter with different `initialEntries` to test URL-based active state
  - Test all status types and their ordering
  - Test sorting logic carefully (order then id)
  - Use semantic queries from React Testing Library
  - Test status badge rendering (colors, labels)
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: TaskList component exists but has no tests

## Related Tasks

- Previous: TASK-11 (Add tests for AgentConfigView)
- Next: TASK-13 (Add tests for TaskListView)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (recommended)
  - TASK-4: Configure coverage thresholds
- Related: TASK-13 (TaskListView uses this component)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive unit tests for the TaskList component.

**Definition of Done**: 

1. **Test file created**:
   - `src/components/__tests__/TaskList.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - Status grouping tested
   - Sorting within groups tested
   - Active state tested (from prop and URL)
   - Task selection tested
   - Status badges tested
   - Rendering tested

3. **Tests pass**:
   - All TaskList tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - TaskList component has adequate test coverage
   - Coverage meets project thresholds (≥80% minimum)

5. **Code quality**:
   - Tests use semantic queries
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add comprehensive tests for TaskList component`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the TaskList component
   - **I want** comprehensive unit tests that verify grouping, sorting, active states, and status display
   - **So that** I can confidently refactor and extend the component without breaking functionality

8. **Automated Tests**:
   - All TaskList tests written and passing
   - Test coverage for component meets requirements
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- TaskList.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/components/__tests__/TaskList.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (grouping, sorting, active states, selection, badges)
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
