# TASK-21.1: Add tests for `src/api/repositories.ts` - `getWorkingDirectoryFiles` function

**Section**: 4. Unit Tests for Untested API Clients (Phase 2B)
**Subsection**: 4.2 Repository API Client
**Task ID**: TASK-21.1
**Parent Task**: TASK-21
**Order**: 1 of 2

## Description

This task creates comprehensive unit tests for the `getWorkingDirectoryFiles` function in the `src/api/repositories.ts` API client module. This function retrieves the file tree for the working directory.

The tests will verify:
- Successful JSON responses
- 404 responses (working directory not found)
- Non-JSON responses
- Other error responses
- Error message extraction

## Current State

- `src/api/repositories.ts` exists and exports `getWorkingDirectoryFiles` function
- Function uses `getApiBasePath()` for API base path
- Function checks content-type before parsing JSON
- Function handles 404 errors specially
- No tests currently exist for this function

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4 are complete.

## Checklist

### Implementation Steps

- [ ] Step 1: Create test file structure
  - [ ] Create `src/api/__tests__/repositories.test.ts` (if not exists)
  - [ ] Import `getWorkingDirectoryFiles` from `../repositories`
  - [ ] Set up MSW handlers for `/api/working-directory/files`

- [ ] Step 2: Write tests for successful responses
  - [ ] Test: Successful JSON response returns file tree array
  - [ ] Test: Response with correct content-type is parsed
  - [ ] Test: File tree structure is correct (FileNode[])
  - [ ] Test: Nested file tree is returned correctly

- [ ] Step 3: Write tests for 404 response
  - [ ] Test: 404 response throws "Working directory not found" error
  - [ ] Test: Error message is clear and specific

- [ ] Step 4: Write tests for non-JSON and other error responses
  - [ ] Test: Non-JSON response throws error
  - [ ] Test: Other error responses (4xx/5xx) are handled

### Testing

- [ ] Write all test cases for `getWorkingDirectoryFiles`
- [ ] Use MSW to mock API responses
- [ ] Run tests and verify all pass

## Related Tasks

- Parent: TASK-21
- Next: TASK-21.2

## Definition of Done

### Task Type: TESTING TASK

**Definition of Done**: 

1. **Tests written**: All `getWorkingDirectoryFiles` tests written
2. **Tests pass**: All tests pass
3. **Code committed and pushed**: Commit message: `test: add tests for getWorkingDirectoryFiles function`
4. **User Story**: As a developer, I want tests for `getWorkingDirectoryFiles` so that I can verify it works correctly
5. **Automated Tests**: All tests written and passing

**Tests are written, all tests pass, and test coverage meets project requirements**












