# TASK-22.1: Add tests for `src/api/tasks.ts` - `fetchTasks` function

**Section**: 4. Unit Tests for Untested API Clients (Phase 2B)
**Subsection**: 4.3 Tasks API Client
**Task ID**: TASK-22.1
**Parent Task**: TASK-22
**Order**: 1 of 4

## Description

This task creates comprehensive unit tests for the `fetchTasks` function in the `src/api/tasks.ts` API client module. This function fetches tasks with support for pagination, filtering, and sorting, and handles different response formats (array vs paginated).

The tests will verify:
- Calling without params
- Query string construction with all parameters
- Pagination response format handling
- Array-only response format handling
- Error responses

## Current State

- `src/api/tasks.ts` exists and exports `fetchTasks` function
- Function uses `getApiBasePath()` for API base path
- Function handles different response formats (array vs object with pagination)
- No tests currently exist for this function

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4 are complete.

## Checklist

### Implementation Steps

- [ ] Step 1: Create test file structure
  - [ ] Create `src/api/__tests__/tasks.test.ts` (if not exists)
  - [ ] Import `fetchTasks` from `../tasks`
  - [ ] Set up MSW handlers for `/api/tasks` (GET)

- [ ] Step 2: Write tests for fetchTasks without params
  - [ ] Test: Calling without params returns tasks list
  - [ ] Test: Response is parsed correctly
  - [ ] Test: Tasks array is returned

- [ ] Step 3: Write tests for fetchTasks with pagination/filters/sorting
  - [ ] Test: Query string is constructed correctly with all params
  - [ ] Test: Pagination params (page, limit) are included
  - [ ] Test: Filter params (status, status_label, conversation_id) are included
  - [ ] Test: Sort params (sortBy, sortOrder) are included
  - [ ] Test: Response with pagination metadata is parsed correctly
  - [ ] Test: Structured response `{ tasks, pagination }` is returned

- [ ] Step 4: Write tests for array-only response
  - [ ] Test: When backend returns array only, wraps in `{ tasks, pagination? }` correctly
  - [ ] Test: Tasks array is extracted correctly
  - [ ] Test: Pagination is optional when not provided

- [ ] Step 5: Write tests for error responses
  - [ ] Test: Non-JSON response throws error with clear message
  - [ ] Test: Error responses (4xx/5xx) are handled with clear error messages

### Testing

- [ ] Write all test cases for `fetchTasks`
- [ ] Use MSW to mock API responses
- [ ] Run tests and verify all pass

## Related Tasks

- Parent: TASK-22
- Next: TASK-22.2

## Definition of Done

### Task Type: TESTING TASK

**Definition of Done**: 

1. **Tests written**: All `fetchTasks` tests written
2. **Tests pass**: All tests pass
3. **Code committed and pushed**: Commit message: `test: add tests for fetchTasks function`
4. **User Story**: As a developer, I want tests for `fetchTasks` so that I can verify it works correctly
5. **Automated Tests**: All tests written and passing

**Tests are written, all tests pass, and test coverage meets project requirements**







