# TASK-36: Add negative E2E journeys

**Section**: 7. E2E, Accessibility, and Regression Tests (Phase 4)
**Subsection**: 7.5 Negative E2E Testing
**Task ID**: TASK-36

## Description

This task adds negative end-to-end (E2E) test journeys that verify the application handles error conditions gracefully. These tests simulate backend errors (500s, 404s) and verify that the UI shows clear error messages and provides usable retry paths.

The tests will verify:
- 500 errors are handled gracefully
- 404 errors are handled gracefully
- Error messages are clear and actionable
- Retry functionality works
- No uncaught errors in browser console
- Application remains usable after errors

This ensures the application provides a good user experience even when things go wrong.

## Current State

- E2E framework should be set up (from TASK-32)
- E2E tests may exist (from TASK-33)
- Application has error handling in place
- No negative E2E tests currently exist

**Reference Implementation**: 
- E2E framework documentation
- Application error handling
- Existing E2E test patterns

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, TASK-32, TASK-33 are complete (all unit tests, integration tests, and E2E framework setup).

## Checklist

### Preparation and Setup

- [ ] Review E2E framework setup from TASK-32
- [ ] Review application error handling
- [ ] Review application error messages
- [ ] Understand how to simulate backend errors in E2E
- [ ] Review existing E2E test patterns

### Implementation Steps

- [ ] Step 1: Configure backend error simulation
  - [ ] Set up MSW in E2E layer (if applicable) to simulate errors
  - [ ] Or configure test backend to return errors
  - [ ] Or use E2E framework to intercept network requests
  - [ ] Configure error scenarios (500, 404, network errors)

- [ ] Step 2: Create negative E2E test structure
  - [ ] Create `e2e/errors-conversations.spec.ts`
  - [ ] Create `e2e/errors-agents.spec.ts`
  - [ ] Create `e2e/errors-tasks.spec.ts`
  - [ ] Create `e2e/errors-queues.spec.ts`
  - [ ] Create `e2e/errors-repositories.spec.ts`

- [ ] Step 3: Write E2E tests for conversation errors
  - [ ] Test: 500 error during conversation list load shows error message
  - [ ] Test: 404 error during conversation detail load shows "not found" message
  - [ ] Test: Network error shows appropriate error message
  - [ ] Test: Retry button works and reloads data
  - [ ] Test: No uncaught errors in browser console
  - [ ] Test: Application remains usable after error

- [ ] Step 4: Write E2E tests for agent conversation errors
  - [ ] Test: 500 error during agent conversation list load shows error message
  - [ ] Test: 404 error during agent conversation detail load shows error message
  - [ ] Test: Network error shows appropriate error message
  - [ ] Test: Retry functionality works
  - [ ] Test: No uncaught errors in browser console

- [ ] Step 5: Write E2E tests for task errors
  - [ ] Test: 500 error during task list load shows error message
  - [ ] Test: 404 error during task detail load shows "Task not found" message
  - [ ] Test: Network error shows appropriate error message
  - [ ] Test: Retry functionality works
  - [ ] Test: No uncaught errors in browser console

- [ ] Step 6: Write E2E tests for queue errors
  - [ ] Test: 500 error during queue list load shows error message
  - [ ] Test: Network error shows appropriate error message
  - [ ] Test: Retry functionality works
  - [ ] Test: No uncaught errors in browser console

- [ ] Step 7: Write E2E tests for repository errors
  - [ ] Test: 404 error during file tree load shows error message
  - [ ] Test: Network error shows appropriate error message
  - [ ] Test: Retry functionality works
  - [ ] Test: No uncaught errors in browser console

- [ ] Step 8: Write tests for error recovery
  - [ ] Test: After error, user can navigate to other pages
  - [ ] Test: After error, user can retry and succeed
  - [ ] Test: Application state is correct after error recovery
  - [ ] Test: No lingering error states

### Specific Requirements

- [ ] Requirement 1: Error simulation configured
  - Backend errors can be simulated
  - Error scenarios are configurable
  - Errors are realistic

- [ ] Requirement 2: Error handling tested
  - All error types are tested (500, 404, network)
  - Error messages are clear
  - Retry functionality works

- [ ] Requirement 3: User experience tested
  - Application remains usable after errors
  - No uncaught errors in console
  - Error recovery works

- [ ] Requirement 4: Coverage tested
  - All major endpoints have error tests
  - All error types are covered
  - Critical flows have error tests

### Error Handling and Edge Cases

- [ ] Handle case: Multiple errors in sequence
  - Application handles gracefully
  - State is correct

- [ ] Handle case: Error during navigation
  - Application handles gracefully
  - Navigation still works

- [ ] Handle case: Error during user interaction
  - Application handles gracefully
  - User can continue

### Testing

- [ ] Write all negative E2E test cases
- [ ] Configure error simulation
- [ ] Test error scenarios
- [ ] Verify console for uncaught errors
- [ ] Run tests: `npm run e2e`
- [ ] Verify all tests pass
- [ ] Verify error messages are clear
- [ ] Verify retry functionality works

### Documentation

- [ ] Add JSDoc comments to test files if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios
- [ ] Document error simulation approach

### Verification

- [ ] Verify all negative E2E journeys are tested
- [ ] Verify tests pass
- [ ] Verify no uncaught errors in console
- [ ] Verify error messages are clear
- [ ] Verify retry functionality works

## Notes

- This task is part of Section 7: E2E, Accessibility, and Regression Tests (Phase 4)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-32, TASK-33 are complete (all unit tests, integration tests, and E2E framework setup)
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (may be useful for E2E error simulation)
  - TASK-4: Configure coverage thresholds
  - TASK-32: Set up Playwright or Cypress for E2E (required)
  - TASK-33: Implement core E2E journeys (recommended)
- **Important Considerations**: 
  - E2E tests run against real application, so error simulation may need special setup
  - Use E2E framework's network interception capabilities
  - Or use MSW in E2E layer if supported
  - Or configure test backend to return errors
  - Verify console for uncaught errors
  - Test that application remains usable after errors
  - Test retry functionality thoroughly
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: No negative E2E tests exist

## Related Tasks

- Previous: TASK-35 (Add visual regression tests)
- Next: TASK-37 (Raise and enforce coverage to target thresholds)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (may be useful)
  - TASK-4: Configure coverage thresholds
  - TASK-32: Set up Playwright or Cypress for E2E (required)
  - TASK-33: Implement core E2E journeys (recommended)
- Related: TASK-32, TASK-33 (E2E framework and tests)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive negative E2E tests for error scenarios.

**Definition of Done**: 

1. **Error simulation configured**:
   - Backend errors can be simulated in E2E tests
   - Error scenarios are configurable
   - Errors are realistic

2. **Test files created**:
   - Error test files exist for all major endpoints
   - Files follow project conventions and patterns

3. **Tests written**:
   - 500 errors tested for all endpoints
   - 404 errors tested for all endpoints
   - Network errors tested
   - Retry functionality tested
   - Console error checking tested

4. **Tests pass**:
   - All negative E2E tests pass
   - Tests run successfully: `npm run e2e`
   - No uncaught errors in browser console
   - Error messages are clear and actionable

5. **Code quality**:
   - Tests use appropriate error simulation
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - All error test files committed
   - Configuration changes committed (if any)
   - Commit message: `test: add negative E2E journeys for error scenarios`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the application
   - **I want** negative E2E tests that verify error handling and user experience during failures
   - **So that** I can ensure the application provides a good experience even when things go wrong

8. **Automated Tests**:
   - All negative E2E tests written and passing
   - Tests run successfully: `npm run e2e` must complete successfully
   - Test verification: Run `npm run e2e` and confirm all error scenario tests pass
   - Console verification: Confirm no uncaught errors in browser console during error scenarios

**Acceptance Criteria**:
- ✅ Error simulation is configured
- ✅ All error test files created with comprehensive tests
- ✅ All error scenarios tested (500, 404, network errors)
- ✅ Retry functionality tested
- ✅ No uncaught errors in browser console
- ✅ All tests pass
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
