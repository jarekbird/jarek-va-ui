# TASK-25: Add integration tests for navigation + feature flags

**Section**: 6. Integration Tests for Critical Flows (Phase 3)
**Subsection**: 6.1 Navigation & Feature Flags Integration
**Task ID**: TASK-25

## Description

This task creates comprehensive integration tests for the navigation system combined with feature flag behavior. These tests verify that the Navigation component and App routing work correctly together when the ElevenLabs feature flag is enabled or disabled.

The tests will verify:
- Navigation links appear/disappear based on feature flag state
- Routes are accessible or hidden when ElevenLabs is disabled
- Active link state updates correctly as routes change
- Navigation works correctly across different routes
- Feature flag changes affect navigation behavior

This is an integration test that exercises multiple components working together.

## Current State

- `Navigation` component exists and uses `isElevenLabsEnabled()` feature flag
- `App` component exists and uses routing
- Feature flag utility exists at `src/utils/feature-flags.ts`
- Navigation links conditionally render based on feature flag
- No integration tests currently exist for this flow
- Unit tests for Navigation may exist (from TASK-5)

**Reference Implementation**: 
- `src/components/Navigation.tsx`
- `src/App.tsx`
- `src/utils/feature-flags.ts`
- Existing integration test patterns (if any)

**Important**: This task should be executed after TASK-1, TASK-2, TASK-3, TASK-4, TASK-5 are complete (all unit tests for components, APIs, and utilities).

## Checklist

### Preparation and Setup

- [ ] Review `Navigation.tsx` component
- [ ] Review `App.tsx` routing structure
- [ ] Review `isElevenLabsEnabled()` feature flag utility
- [ ] Review existing integration test patterns
- [ ] Understand all routes in the application
- [ ] Understand which routes are feature-flag gated

### Implementation Steps

- [ ] Step 1: Create test file
  - [ ] Create `src/__tests__/navigation-integration.test.tsx`
  - [ ] Import necessary testing utilities and components
  - [ ] Import `App` component
  - [ ] Set up MSW if needed

- [ ] Step 2: Set up test structure
  - [ ] Create describe blocks for different feature flag states
  - [ ] Set up MemoryRouter for routing tests
  - [ ] Mock `isElevenLabsEnabled` function
  - [ ] Set up MSW handlers if needed for API calls

- [ ] Step 3: Write tests for feature flag enabled
  - [ ] Test: Render App with feature flag enabled
  - [ ] Test: All navigation links appear (Dashboard, Note Taking History, Agent Conversations, Agent Config, Tasks, Task Dashboard)
  - [ ] Test: Navigate to `/dashboard` and verify it's accessible
  - [ ] Test: Navigate to `/agent-conversations` and verify it's accessible
  - [ ] Test: Navigate to `/agent-config` and verify it's accessible
  - [ ] Test: Active link state updates correctly as route changes

- [ ] Step 4: Write tests for feature flag disabled
  - [ ] Test: Render App with feature flag disabled
  - [ ] Test: Dashboard link does not appear
  - [ ] Test: Agent Conversations link does not appear
  - [ ] Test: Agent Config link does not appear
  - [ ] Test: Note Taking History link appears
  - [ ] Test: Tasks link appears
  - [ ] Test: Task Dashboard link appears
  - [ ] Test: Navigating to `/dashboard` shows appropriate state (404 or redirect)
  - [ ] Test: Navigating to `/agent-conversations` shows appropriate state
  - [ ] Test: Navigating to `/agent-config` shows appropriate state

- [ ] Step 5: Write tests for active link state
  - [ ] Test: Active link state updates when navigating to different routes
  - [ ] Test: Only one link is active at a time
  - [ ] Test: Active state works for all routes
  - [ ] Test: Active state works when feature flag changes

- [ ] Step 6: Write tests for route navigation
  - [ ] Test: Clicking navigation links navigates to correct routes
  - [ ] Test: Browser back/forward buttons work correctly
  - [ ] Test: Direct URL navigation works correctly
  - [ ] Test: Route changes update active link state

### Specific Requirements

- [ ] Requirement 1: Feature flag behavior tested
  - Navigation links appear/disappear correctly
  - Routes are accessible/hidden correctly
  - Feature flag changes affect navigation

- [ ] Requirement 2: Active link state tested
  - Active state updates correctly
  - Only one link is active at a time
  - Active state works for all routes

- [ ] Requirement 3: Route navigation tested
  - Navigation links work correctly
  - Route changes work correctly
  - Browser navigation works correctly

- [ ] Requirement 4: Integration tested
  - Multiple components work together
  - Feature flag affects multiple parts of the app
  - Navigation and routing are integrated correctly

### Error Handling and Edge Cases

- [ ] Handle case: Feature flag changes during navigation
  - Navigation updates correctly
  - No errors thrown

- [ ] Handle case: Invalid route navigation
  - App handles gracefully
  - Appropriate 404 or error state shown

- [ ] Handle case: Rapid route changes
  - App handles gracefully
  - Active state updates correctly

### Testing

- [ ] Write all integration test cases
- [ ] Use MemoryRouter for routing tests
- [ ] Mock feature flag function
- [ ] Use MSW if needed for API calls
- [ ] Use userEvent for navigation interactions
- [ ] Run tests: `npm test -- navigation-integration.test.tsx`
- [ ] Verify all tests pass
- [ ] Run full test suite: `npm test`
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] Check test coverage

### Documentation

- [ ] Add JSDoc comments to test file if needed
- [ ] Document test patterns used
- [ ] Add comments for complex test scenarios
- [ ] Document feature flag behavior

### Verification

- [ ] Verify all navigation + feature flag integration is tested
- [ ] Verify tests pass
- [ ] Verify no regressions in other tests
- [ ] Verify test coverage meets requirements

## Notes

- This task is part of Section 6: Integration Tests for Critical Flows (Phase 3)
- **Execution Timing**: Execute after TASK-1, TASK-2, TASK-3, TASK-4, TASK-5 are complete (all unit tests for components, APIs, and utilities)
- **Dependencies**: 
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (recommended)
  - TASK-4: Configure coverage thresholds
  - TASK-5: Add tests for Navigation (unit tests should be complete)
- **Important Considerations**: 
  - This is an integration test - test multiple components working together
  - Mock feature flag function to control state
  - Use MemoryRouter for routing tests
  - Test both enabled and disabled states thoroughly
  - Test active link state updates
  - Use userEvent for realistic user interactions
- **Task Independence**: Can be completed independently after prerequisites
- **Current State**: Navigation and App components exist but have no integration tests

## Related Tasks

- Previous: TASK-24 (Add tests for detectBasename)
- Next: TASK-26 (Add integration tests for task dashboard flow)
- Dependencies:
  - TASK-1: Confirm local setup
  - TASK-2: Review existing test utilities
  - TASK-3: Introduce MSW (recommended)
  - TASK-4: Configure coverage thresholds
  - TASK-5: Add tests for Navigation
- Related: TASK-5 (Navigation unit tests), TASK-26 (Task dashboard integration)

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing comprehensive integration tests for navigation and feature flags working together.

**Definition of Done**: 

1. **Test file created**:
   - `src/__tests__/navigation-integration.test.tsx` exists
   - File follows project conventions and patterns

2. **Tests written**:
   - Feature flag enabled scenario tested
   - Feature flag disabled scenario tested
   - Active link state tested
   - Route navigation tested

3. **Tests pass**:
   - All navigation integration tests pass
   - Full test suite passes: `npm test`
   - No test failures or errors

4. **Coverage meets requirements**:
   - Integration test coverage is adequate
   - Coverage meets project thresholds

5. **Code quality**:
   - Tests use semantic queries
   - Tests use appropriate mocking
   - Tests are readable and maintainable
   - No linting errors
   - Type checking passes

6. **Code committed and pushed**:
   - Test file committed
   - Commit message: `test: add integration tests for navigation and feature flags`
   - Code pushed to origin: `git push origin <branch-name>`

7. **User Story** (as a developer):
   - **As a** developer maintaining the navigation system
   - **I want** comprehensive integration tests that verify navigation and feature flags work together correctly
   - **So that** I can confidently refactor and extend the navigation system without breaking functionality

8. **Automated Tests**:
   - All navigation integration tests written and passing
   - Full test suite passes: `npm test` must complete successfully
   - Test verification: Run `npm test -- navigation-integration.test.tsx` and confirm all tests pass

**Acceptance Criteria**:
- ✅ `src/__tests__/navigation-integration.test.tsx` created with comprehensive tests
- ✅ All scenarios tested (feature flag enabled/disabled, active states, navigation)
- ✅ All tests pass
- ✅ Test coverage meets requirements
- ✅ All changes committed and pushed to origin

**Tests are written, all tests pass, and test coverage meets project requirements**
