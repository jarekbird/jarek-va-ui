# Scaffold Agent Conversation List/Detail Views

## Scope
`jarek-va-ui`.

## Subtasks
- Create `AgentConversationListView.tsx` that:
  - Lists conversations using `listAgentConversations()`.
  - Shows loading and error states.
- Create `AgentConversationDetailView.tsx` as a wrapper for a single conversation, driven by route param.
- Create `AgentConversationDetails.tsx` as the main detail component (without voice yet):
  - Shows messages.
  - Provides a basic text input to send text-only messages (stubbed for now if backend not ready).
- Add navigation to "Agent Conversations" in the main app layout or side nav.
- Add routes for list and detail views in `App.tsx` or router configuration.

## Desired Outcomes

### Primary Outcomes
1. **Complete UI Structure**: Full navigation and routing for agent conversations, allowing users to browse and view conversations.

2. **Consistent UX**: Agent conversation views follow the same patterns as note-taking views for familiarity and consistency.

3. **Loading States**: Proper loading indicators so users know when data is being fetched.

4. **Error Handling**: Clear error messages when API calls fail, with options to retry.

5. **Routing Integration**: Seamless integration with React Router, supporting direct links to specific conversations.

### Success Criteria
- List view displays all agent conversations
- Detail view shows conversation messages
- Loading states visible during API calls
- Error states handled gracefully
- Navigation accessible from main app
- Routes work with browser back/forward
- Direct links to conversations work
- Text input ready for message sending (can be stubbed)

## User Stories

### As a User
- **Story 1**: I want to see a list of my agent conversations so that I can find and open previous conversations.
- **Story 2**: I want to view a conversation's message history so that I can see what was discussed.
- **Story 3**: I want to see loading indicators so that I know the app is working when fetching data.
- **Story 4**: I want clear error messages so that I understand when something goes wrong.

### As a Developer
- **Story 5**: I want consistent component patterns so that I can reuse code and maintain consistency.
- **Story 6**: I want proper routing so that users can bookmark and share conversation links.

## Suggested Automated Tests

### Component Tests
1. **List View Tests**:
   ```typescript
   describe('AgentConversationListView', () => {
     it('renders list of conversations', async () => {
       const mockConversations = [/* ... */];
       jest.spyOn(api, 'listAgentConversations').mockResolvedValue(mockConversations);
       
       render(<AgentConversationListView />);
       await waitFor(() => {
         expect(screen.getByText(mockConversations[0].id)).toBeInTheDocument();
       });
     });
     
     it('shows loading state', () => {
       jest.spyOn(api, 'listAgentConversations').mockImplementation(
         () => new Promise(() => {}) // Never resolves
       );
       render(<AgentConversationListView />);
       expect(screen.getByText(/loading/i)).toBeInTheDocument();
     });
     
     it('shows error state', async () => {
       jest.spyOn(api, 'listAgentConversations').mockRejectedValue(new Error('Failed'));
       render(<AgentConversationListView />);
       await waitFor(() => {
         expect(screen.getByText(/error/i)).toBeInTheDocument();
       });
     });
   });
   ```

2. **Detail View Tests**:
   ```typescript
   describe('AgentConversationDetails', () => {
     it('displays conversation messages', async () => {
       const mockConversation = { messages: [/* ... */] };
       jest.spyOn(api, 'getAgentConversation').mockResolvedValue(mockConversation);
       
       render(<AgentConversationDetails conversationId="123" />);
       await waitFor(() => {
         expect(screen.getByText(mockConversation.messages[0].content)).toBeInTheDocument();
       });
     });
     
     it('renders text input for sending messages', () => {
       render(<AgentConversationDetails conversationId="123" />);
       expect(screen.getByPlaceholderText(/type a message/i)).toBeInTheDocument();
     });
   });
   ```

### Routing Tests
3. **Navigation Tests**:
   ```typescript
   describe('Agent Conversation Routing', () => {
     it('navigates to list view', () => {
       render(<App />);
       fireEvent.click(screen.getByText('Agent Conversations'));
       expect(screen.getByText(/agent conversations/i)).toBeInTheDocument();
     });
     
     it('navigates to detail view with ID', () => {
       render(<App />);
       // Navigate to detail
       expect(window.location.pathname).toContain('/agent-conversations/123');
     });
   });
   ```

### Integration Tests
4. **Full Flow Tests**:
   ```typescript
   describe('Agent Conversation Flow', () => {
     it('loads list, clicks conversation, views detail', async () => {
       // Full user flow test
     });
   });
   ```

## Inherent Risks

### High Risk
1. **Routing Conflicts**:
   - **Risk**: Agent conversation routes conflict with note-taking routes, causing navigation issues
   - **Mitigation**: Use distinct route prefixes, test all navigation paths, verify no conflicts

2. **State Management Issues**:
   - **Risk**: Conversation data not properly managed, causing stale data or memory leaks
   - **Mitigation**: Proper React hooks usage, cleanup on unmount, state management patterns

### Medium Risk
3. **Performance with Large Lists**:
   - **Risk**: List view slow with many conversations
   - **Mitigation**: Implement pagination or virtualization, lazy loading, performance testing

4. **Error State UX**:
   - **Risk**: Poor error handling leading to confusing user experience
   - **Mitigation**: Clear error messages, retry buttons, fallback UI

5. **Loading State Timing**:
   - **Risk**: Loading states flash too quickly or take too long
   - **Mitigation**: Debounce loading indicators, minimum display time, skeleton screens

### Low Risk
6. **Styling Inconsistencies**:
   - **Risk**: Agent conversation views look different from note-taking views
   - **Mitigation**: Reuse components, follow design system, visual QA

7. **Accessibility Issues**:
   - **Risk**: Views not accessible to screen readers or keyboard navigation
   - **Mitigation**: Use semantic HTML, ARIA labels, keyboard navigation testing
