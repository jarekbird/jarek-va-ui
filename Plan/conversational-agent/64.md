# Step 64: Add Operational Runbook

**Phase**: Phase 4 â€“ Polish, Error Handling, Testing, Documentation

## Description

Add a short "operational runbook" section to docs:
- How to restart `elevenlabs-agent` safely.
- How to clear stuck sessions/tasks in Redis (key patterns).
- Common failure modes (network issues, expired sessions, missing Redis).

## Detailed Desired Outcomes

### Operational Procedures

**Service Restart:**
- Safe restart procedure
- Graceful shutdown (if implemented)
- Health check verification after restart
- Impact on active sessions (sessions will be lost, users need to reconnect)

**Redis Cleanup:**
- Key patterns to identify:
  - `elevenlabs:session:*` - Active sessions (should expire automatically)
  - `cursor_task:*` - Pending tasks (should expire automatically)
  - `elevenlabs:conversation:*` - Conversations (persistent)
- Commands to clear stuck sessions/tasks
- When to clear (e.g., stuck tasks older than 24 hours)
- Backup before clearing (if needed)

**Common Failure Modes:**
- Network issues: Symptoms, diagnosis, resolution
- Expired sessions: Symptoms, diagnosis, resolution
- Missing Redis: Symptoms, diagnosis, resolution
- Webhook failures: Symptoms, diagnosis, resolution
- Callback failures: Symptoms, diagnosis, resolution

**Monitoring:**
- Key metrics to monitor
- Log patterns to watch for
- Alert conditions
- Health check endpoints

## User Stories

**As an operator**, I want:
- Clear procedures for common operations
- Easy troubleshooting steps
- Quick resolution of issues

**As a developer**, I want:
- Operational knowledge documented
- Easy to maintain procedures
- Clear escalation paths

**As a system**, I want:
- Reliable operations
- Quick issue resolution
- Proper monitoring

## Suggested Automated Tests

### Operational Procedures Tests

```typescript
// Operational procedures are typically validated through:
// 1. Manual testing
// 2. Runbook review
// 3. Procedure validation

describe('Operational Procedures', () => {
  it('should have restart procedure documented', () => {
    const runbook = fs.readFileSync('docs/runbook.md', 'utf-8');
    expect(runbook).toContain('restart');
    expect(runbook).toContain('elevenlabs-agent');
  });

  it('should have Redis cleanup commands', () => {
    const runbook = fs.readFileSync('docs/runbook.md', 'utf-8');
    expect(runbook).toContain('elevenlabs:session');
    expect(runbook).toContain('cursor_task');
  });
});
```

## Risks

### Low Risk
- **Outdated procedures**: Procedures might become outdated
  - **Mitigation**: Keep runbook updated, review regularly
  - **Detection**: Procedure failures, operator feedback

- **Missing procedures**: Some scenarios might not be covered
  - **Mitigation**: Comprehensive runbook, learn from incidents
  - **Detection**: Incident reviews, operator questions

### Medium Risk
- **Incorrect procedures**: Procedures might be wrong
  - **Mitigation**: Test procedures, review with team
  - **Detection**: Procedure failures, operator feedback

### High Risk
- **None identified** - Runbook creation with low risk

## Implementation Notes

- Document restart procedures
- Document Redis key patterns for cleanup
- Document common issues and solutions
- Add troubleshooting steps
- Include commands for common operations
- Document monitoring/observability
- Add examples
- Review with team
- Keep runbook updated
- Include escalation procedures
