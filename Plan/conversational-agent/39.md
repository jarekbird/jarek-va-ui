# Implement Backend Feature Flag Checks

## Scope
`cursor-runner`, `elevenlabs-agent`.

## Subtasks
- In `elevenlabs-agent`, short-circuit webhook, signed-url, and session routes when `ELEVENLABS_AGENT_ENABLED` is false.
- In `cursor-runner`, ensure cursor completion callbacks only attempt ElevenLabs integration when flag is true.
- Add logging so it's clear when flags are blocking functionality.

## Desired Outcomes

### Primary Outcomes
1. **Route Protection**: All agent-related routes disabled when feature flag is off.

2. **Callback Gating**: Cursor completion callbacks only trigger ElevenLabs integration when flag is enabled.

3. **Clear Logging**: Logs indicate when flags are blocking functionality for debugging.

4. **Safe Deployment**: Services can be deployed with features disabled, enabling dark release.

### Success Criteria
- Routes return 503 when disabled
- Callbacks skip ElevenLabs when disabled
- Logging indicates flag status
- No errors when flag disabled
- Tests verify flag behavior
- Documentation updated

## User Stories

### As a Developer
- **Story 1**: I want route protection so that I can deploy safely with features disabled.
- **Story 2**: I want clear logging so that I can debug flag-related issues.

### As a DevOps Engineer
- **Story 3**: I want feature flags so that I can enable features gradually.

## Suggested Automated Tests

### Unit Tests
1. **Route Protection Tests**:
   ```typescript
   describe('Route Protection', () => {
     it('returns 503 when feature disabled', async () => {
       process.env.ELEVENLABS_AGENT_ENABLED = 'false';
       const response = await request(app)
         .post('/agent-tools')
         .expect(503);
     });
   });
   ```

2. **Callback Gating Tests**:
   ```typescript
   describe('Callback Gating', () => {
     it('skips ElevenLabs when flag disabled', async () => {
       process.env.ELEVENLABS_AGENT_ENABLED = 'false';
       // Verify callback doesn't attempt ElevenLabs push
     });
   });
   ```

## Inherent Risks

### Medium Risk
1. **Incomplete Gating**:
   - **Risk**: Some routes or callbacks not gated
   - **Mitigation**: Systematic review, tests, code review

2. **Logging Noise**:
   - **Risk**: Too much logging when flag disabled
   - **Mitigation**: Appropriate log levels, clear messages

### Low Risk
3. **Flag Misconfiguration**:
   - **Risk**: Flag not set correctly
   - **Mitigation**: Default to false, validation, documentation
