# Add Frontend Unit Tests for Voice Service

## Scope
`jarek-va-ui`.

## Subtasks
- Add tests in `src/services/__tests__/elevenlabs-voice.test.ts` for:
  - Connection state transitions.
  - Retry and backoff behavior.
  - Signed URL renewal triggers.
  - Heartbeat and timeout handling.

## Desired Outcomes

### Primary Outcomes
1. **Comprehensive Test Coverage**: All voice service functionality covered by automated tests.

2. **State Machine Validation**: Tests verify state transitions work correctly.

3. **Failure Handling Verification**: Tests confirm retry, backoff, and recovery logic work as designed.

4. **Reliability Confidence**: Test suite provides confidence that voice service handles edge cases correctly.

### Success Criteria
- State transition tests pass
- Retry/backoff tests pass
- Signed URL renewal tests pass
- Heartbeat tests pass
- Timeout tests pass
- Test coverage > 80%
- All critical paths tested
- Tests run in CI

## User Stories

### As a Developer
- **Story 1**: I want comprehensive tests so that I can refactor the voice service confidently.
- **Story 2**: I want state machine tests so that I know state transitions work correctly.

## Suggested Automated Tests

### Unit Tests
1. **State Transition Tests**:
   ```typescript
   describe('State Transitions', () => {
     it('transitions: disconnected → connecting → connected', async () => {
       const service = new ElevenLabsVoiceService();
       expect(service.getConnectionStatus()).toBe('disconnected');
       await service.startVoiceSession('agent-123');
       expect(service.getConnectionStatus()).toBe('connected');
     });
   });
   ```

2. **Retry Tests** (covered in Task 23 expansion)
3. **Signed URL Renewal Tests** (covered in Task 27 expansion)
4. **Heartbeat Tests** (covered in Task 28 expansion)

## Inherent Risks

### Medium Risk
1. **Test Complexity**:
   - **Risk**: Tests too complex or brittle
   - **Mitigation**: Keep tests simple, mock external dependencies, maintain test utilities

2. **Mock Accuracy**:
   - **Risk**: Mocks don't accurately represent SDK behavior
   - **Mitigation**: Test with real SDK when possible, update mocks as SDK changes

### Low Risk
3. **Test Maintenance**:
   - **Risk**: Tests require constant updates
   - **Mitigation**: Test behavior not implementation, stable test structure
