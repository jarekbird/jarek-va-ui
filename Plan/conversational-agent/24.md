# Design ElevenLabs Voice Service Interface

## Scope
`jarek-va-ui`.

## Subtasks
- Define a TypeScript interface or class contract for `elevenlabs-voice` service:
  - Methods: `startVoiceSession`, `endVoiceSession`, `getConnectionStatus`, `sendTextToAgent`.
  - Events/hooks for `onConnect`, `onDisconnect`, `onModeChange`, `onError`, `onMessage`.
- Decide on state machine states (`connecting`, `connected`, `reconnecting`, `failed`, `disconnected`).
- Document the interface in comments referencing the plan sections.

## Desired Outcomes

### Primary Outcomes
1. **Clear Interface Design**: Well-defined TypeScript interface that serves as a contract for the voice service implementation.

2. **State Machine Definition**: Clear state machine with all possible states and transitions documented.

3. **Event System**: Event/hook system for components to react to service state changes.

4. **Documentation**: Comprehensive documentation explaining the interface and its usage.

### Success Criteria
- Interface defined with all methods
- Event system designed
- State machine documented
- TypeScript types complete
- Code comments explain design decisions
- References to master plan included
- Ready for implementation

## User Stories

### As a Developer
- **Story 1**: I want a clear interface so that I know what methods and events are available.
- **Story 2**: I want state machine documentation so that I understand state transitions.

### As a Code Reviewer
- **Story 3**: I want documented design decisions so that I can understand the architecture.

## Suggested Automated Tests

### Interface Tests
1. **Type Safety Tests**:
   ```typescript
   describe('Voice Service Interface', () => {
     it('has required methods', () => {
       const service: ElevenLabsVoiceService = {
         startVoiceSession: jest.fn(),
         endVoiceSession: jest.fn(),
         getConnectionStatus: jest.fn(),
         sendTextToAgent: jest.fn()
       };
       // TypeScript ensures all methods present
     });
   });
   ```

2. **State Machine Tests**:
   ```typescript
   describe('State Machine', () => {
     it('transitions through valid states', () => {
       // Test state transitions
     });
     
     it('rejects invalid state transitions', () => {
       // Test invalid transitions
     });
   });
   ```

## Inherent Risks

### Medium Risk
1. **Interface Changes**:
   - **Risk**: Interface needs changes after implementation starts
   - **Mitigation**: Review thoroughly, consider all use cases, iterate if needed

2. **State Machine Complexity**:
   - **Risk**: State machine too complex or missing states
   - **Mitigation**: Document all states, test transitions, keep it simple

### Low Risk
3. **Event System Design**:
   - **Risk**: Event system not flexible enough
   - **Mitigation**: Use standard patterns, make it extensible, review design
