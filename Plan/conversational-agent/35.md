# Implement Optional Structured Metadata Push (Future Toggle)

## Scope
`elevenlabs-agent`.

## Subtasks
- Add an internal option or config flag to send enhanced metadata with `cursor_task_complete` text.
- Include fields like `summary`, `branch`, `files_changed`, and `duration`.
- Keep MVP default as simple-text until proven stable.

## Desired Outcomes

### Primary Outcomes
1. **Enhanced Metadata Support**: Optional structured metadata format for better agent reasoning about task completions.

2. **Feature Toggle**: Internal flag allows enabling/disabling metadata format without code changes.

3. **Backward Compatibility**: MVP simple-text format remains default, ensuring stability.

4. **Future Extensibility**: Structure allows adding more metadata fields as needed.

### Success Criteria
- Metadata format implemented
- Feature toggle works
- Simple-text remains default
- Metadata includes required fields
- Tests cover both formats
- Documentation explains both formats

## User Stories

### As a Developer
- **Story 1**: I want structured metadata so that agents can reason better about task completions.
- **Story 2**: I want a feature toggle so that I can experiment safely.

## Suggested Automated Tests

### Unit Tests
1. **Metadata Format Tests**:
   ```typescript
   describe('Structured Metadata', () => {
     it('constructs metadata message when enabled', () => {
       process.env.USE_METADATA_FORMAT = 'true';
       const message = constructCompletionMessage(result, true);
       expect(message).toHaveProperty('metadata');
       expect(message.metadata).toHaveProperty('summary');
       expect(message.metadata).toHaveProperty('files_changed');
     });
   });
   ```

2. **Feature Toggle Tests**:
   ```typescript
   describe('Feature Toggle', () => {
     it('uses simple text when disabled', () => {
       process.env.USE_METADATA_FORMAT = 'false';
       const message = constructCompletionMessage(result);
       expect(message).not.toHaveProperty('metadata');
     });
   });
   ```

## Inherent Risks

### Medium Risk
1. **Metadata Format Rejection**:
   - **Risk**: ElevenLabs doesn't support metadata format, causing errors
   - **Mitigation**: Test thoroughly, keep simple-text default, feature toggle

2. **Format Complexity**:
   - **Risk**: Metadata format too complex, causing parsing issues
   - **Mitigation**: Keep it simple, validate format, test thoroughly

### Low Risk
3. **Agent Reasoning Issues**:
   - **Risk**: Agent doesn't use metadata effectively
   - **Mitigation**: Experiment, optimize format, user feedback
