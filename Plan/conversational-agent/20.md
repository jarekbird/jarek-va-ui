# Containerize elevenlabs-agent and Wire into Docker/Trafik

## Scope
`elevenlabs-agent`, root Docker orchestration.

## Subtasks
- Implement `Dockerfile` for elevenlabs-agent, mirroring patterns from `cursor-runner`.
- Add `elevenlabs-agent` service to docker-compose with:
  - Shared network.
  - Environment variables.
  - Redis connection.
- Add Traefik routing rules to expose `/elevenlabs/*` or `/agent/*` paths.
- Smoke test health endpoint through Traefik.

## Desired Outcomes

### Primary Outcomes
1. **Containerization**: Service runs reliably in Docker containers, matching production environment.

2. **Service Integration**: Service integrated into existing Docker Compose setup with proper networking.

3. **Traefik Routing**: Service accessible through Traefik reverse proxy with correct routing rules.

4. **Environment Configuration**: All environment variables properly configured in Docker Compose.

5. **Health Verification**: Health endpoint accessible through Traefik, confirming service is working.

### Success Criteria
- Dockerfile builds successfully
- Service starts in Docker Compose
- Health endpoint accessible through Traefik
- Redis connection works
- Environment variables loaded correctly
- Network connectivity verified
- Follows patterns from cursor-runner
- Documentation updated

## User Stories

### As a Developer
- **Story 1**: I want Docker setup so that I can run the full stack locally.
- **Story 2**: I want Traefik routing so that I can access the service consistently.

### As a DevOps Engineer
- **Story 3**: I want containerized service so that I can deploy it easily.
- **Story 4**: I want health checks so that I can monitor service health.

## Suggested Automated Tests

### Integration Tests
1. **Docker Build Tests**:
   ```bash
   # Test Dockerfile builds
   docker build -t elevenlabs-agent .
   # Should complete successfully
   ```

2. **Docker Compose Tests**:
   ```bash
   # Test service starts
   docker-compose up -d elevenlabs-agent
   # Verify service is running
   docker-compose ps
   ```

3. **Health Check Tests**:
   ```typescript
   describe('Health Check via Traefik', () => {
     it('health endpoint accessible', async () => {
       const response = await fetch('http://localhost/elevenlabs/health');
       expect(response.status).toBe(200);
     });
   });
   ```

4. **Network Connectivity Tests**:
   ```typescript
   describe('Network Connectivity', () => {
     it('connects to Redis', async () => {
       // Verify Redis connection from container
     });
     
     it('connects to cursor-runner', async () => {
       // Verify cursor-runner connectivity
     });
   });
   ```

## Inherent Risks

### High Risk
1. **Network Configuration Issues**:
   - **Risk**: Services unable to communicate due to network misconfiguration
   - **Mitigation**: Use Docker Compose networks, verify connectivity, clear documentation

2. **Traefik Routing Errors**:
   - **Risk**: Incorrect routing rules causing 404s or wrong service responses
   - **Mitigation**: Test routing thoroughly, verify labels, check Traefik logs

### Medium Risk
3. **Environment Variable Issues**:
   - **Risk**: Missing or incorrect environment variables causing runtime errors
   - **Mitigation**: Validate on startup, clear error messages, documentation

4. **Port Conflicts**:
   - **Risk**: Port conflicts with other services
   - **Mitigation**: Use Traefik routing, avoid hardcoded ports, verify ports

5. **Build Failures**:
   - **Risk**: Dockerfile doesn't build or produces incorrect image
   - **Mitigation**: Test builds, follow best practices, review Dockerfile

### Low Risk
6. **Image Size**:
   - **Risk**: Docker image too large, slowing deployments
   - **Mitigation**: Multi-stage builds, optimize layers, review dependencies

7. **Development vs Production Differences**:
   - **Risk**: Different behavior in Docker vs local development
   - **Mitigation**: Consistent configuration, test both environments
