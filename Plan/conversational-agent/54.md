# Step 54: Integrate File Browser into Note-Taking View

**Phase**: Phase 3 â€“ Frontend Integration (UI, Conversations, File Browser)

## Description

Integrate `RepositoryFileBrowser` into note-taking `ConversationDetails`:
- Pass the current repository (from conversation metadata or config).
- Trigger `getRepositoryFileTree` and fetch results to the browser component.

## Detailed Desired Outcomes

### Component Integration

**File Browser Placement:**
- Add `RepositoryFileBrowser` to `ConversationDetails` component
- Place in side panel or dedicated section
- Don't interfere with conversation messages
- Responsive layout (collapse on mobile)

**Repository Selection:**
- Extract repository from conversation metadata (if available)
- Or use default/hard-coded repository for now
- Or allow user to select repository (future enhancement)
- Pass repository name to file browser

**Data Flow:**
1. Component mounts or repository changes
2. Call `getRepositoryFileTree(repositoryName)`
3. Show loading state
4. Pass file tree to `RepositoryFileBrowser`
5. Handle errors gracefully

**State Management:**
- Track loading state
- Track error state
- Track file tree data
- Update when repository changes

## User Stories

**As a user**, I want:
- To see repository structure while viewing conversation
- File browser that loads quickly
- Clear indication when files are loading
- Easy to browse repository structure

**As a developer**, I want:
- Easy integration of file browser
- Clear data flow
- Proper error handling

**As a designer**, I want:
- File browser that fits the layout
- Good use of space
- Responsive design

## Suggested Automated Tests

### Integration Tests

```typescript
describe('File Browser Integration', () => {
  it('should render file browser in ConversationDetails', () => {
    render(<ConversationDetails conversation={mockConversation} />);
    expect(screen.getByText(/Repository Files/i)).toBeInTheDocument();
  });

  it('should fetch file tree on mount', async () => {
    const getRepositoryFileTreeSpy = jest.spyOn(api, 'getRepositoryFileTree');
    
    render(<ConversationDetails conversation={mockConversation} />);

    await waitFor(() => {
      expect(getRepositoryFileTreeSpy).toHaveBeenCalled();
    });
  });

  it('should pass file tree to RepositoryFileBrowser', async () => {
    const mockFiles: FileNode[] = [
      { name: 'src', path: 'src', type: 'directory', children: [] }
    ];
    
    jest.spyOn(api, 'getRepositoryFileTree').mockResolvedValue(mockFiles);

    render(<ConversationDetails conversation={mockConversation} />);

    await waitFor(() => {
      expect(screen.getByText('src')).toBeInTheDocument();
    });
  });

  it('should handle file tree errors', async () => {
    jest.spyOn(api, 'getRepositoryFileTree').mockRejectedValue(
      new Error('Failed to load')
    );

    render(<ConversationDetails conversation={mockConversation} />);

    await waitFor(() => {
      expect(screen.getByText(/Failed to load files/i)).toBeInTheDocument();
    });
  });
});
```

## Risks

### Low Risk
- **Repository not available**: Repository might not be in metadata
  - **Mitigation**: Use default repository, handle missing gracefully
  - **Detection**: Integration tests, user reports

- **Layout issues**: File browser might not fit well
  - **Mitigation**: Responsive design, test various screen sizes
  - **Detection**: Visual testing, responsive testing

### Medium Risk
- **Performance**: Loading file tree might slow down conversation view
  - **Mitigation**: Load asynchronously, show loading state
  - **Detection**: Performance testing, user feedback

### High Risk
- **None identified** - File browser integration with low risk

## Implementation Notes

- Add RepositoryFileBrowser to ConversationDetails component
- Determine current repository (from metadata or config)
- Call getRepositoryFileTree API
- Pass file tree to browser component
- Handle loading and error states
- Display in appropriate location (side panel, etc.)
- Test with various repository sizes
- Ensure responsive design
- Consider making file browser collapsible
